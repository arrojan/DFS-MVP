<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DFS Document Generator</title>
    <style>
        :root {
            --primary-color: #0078d4;
            --primary-hover: #005a9e;
            --secondary-color: #4CAF50;
            --secondary-hover: #45a049;
            --light-gray: #f8f8f8;
            --border-color: #ddd;
            --text-color: #333;
            --progress-color: #4CAF50;
            --progress-bg: #e0e0e0;
            --step1-color: #4CAF50;
            --step2-color: #4CAF50;
            --step3-color: #0078d4;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            color: var(--text-color);
            line-height: 1.6;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .section {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .section:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .welcome-section {
            background-color: var(--light-gray);
            border-left: 5px solid var(--primary-color);
        }

        .welcome-section h2 {
            color: var(--primary-color);
            margin-top: 0;
        }

        .hidden {
            display: none;
        }

        .device-option {
            display: inline-block;
            margin: 10px;
            padding: 15px 25px;
            background-color: white;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .device-option:hover {
            border-color: var(--primary-color);
            background-color: #f0f7ff;
        }

        .device-option.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .component-option {
            margin: 12px 0;
        }

        button {
            padding: 12px 20px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: var(--secondary-hover);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-gap: 15px;
        }

        .device-type-dropdown {
            margin: 15px 0;
            padding: 12px;
            font-size: 16px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            width: 100%;
            max-width: 300px;
        }

        .quip-options {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        #copySuccess {
            color: var(--secondary-color);
            margin-left: 10px;
            display: none;
            font-weight: bold;
        }

        .instructions {
            margin-top: 15px;
            padding: 15px;
            background-color: var(--light-gray);
            border-left: 4px solid var(--secondary-color);
            border-radius: 4px;
        }

        .instructions h4 {
            margin-top: 0;
            color: var(--secondary-color);
        }

        .instructions ol {
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        /* For the temporary textarea used for copying */
        #tempTextArea {
            position: absolute;
            left: -9999px;
            top: 0;
            opacity: 0;
        }

        /* Link buttons styling */
        .link-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .link-button {
            display: inline-block;
            padding: 12px 20px;
            background-color: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .link-button:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .step-number {
            display: inline-block;
            width: 28px;
            height: 28px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            margin-right: 10px;
            font-weight: bold;
        }

        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .section-title h2 {
            margin: 0;
        }

        .action-buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .primary-button {
            background-color: var(--primary-color);
        }

        .primary-button:hover {
            background-color: var(--primary-hover);
        }

        input[type="checkbox"] {
            transform: scale(1.2);
            margin-right: 8px;
        }

        label {
            cursor: pointer;
        }

        /* Updated progress indicator styling with fill animation */
        .progress-container {
            position: relative;
            margin: 60px 0;
            height: 100px; /* Increased height for more space */
        }

        .progress-bar {
            position: absolute;
            top: 50%; /* Center vertically */
            left: 0;
            right: 0;
            height: 4px;
            background-color: var(--progress-bg); /* Gray background */
        }

        .progress-bar-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%; /* Starts at 0% and grows as steps are completed */
            background-color: var(--progress-color); /* Green fill */
            transition: width 0.5s ease;
        }

        .progress-steps {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
        }

        .progress-step {
            position: relative;
            text-align: center;
            width: 33.33%;
        }

        .step-circle {
            position: absolute;
            top: 30px; /* Position circle above the line */
            left: 50%;
            transform: translateX(-50%);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--progress-bg); /* Default gray */
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            transition: background-color 0.3s ease;
        }

        .progress-step.active .step-circle {
            background-color: var(--step3-color); /* Blue for active step */
        }

        .progress-step.completed .step-circle {
            background-color: var(--step1-color); /* Green for completed steps */
        }

        .step-label {
            position: absolute;
            top: 75px; /* Position label below the line */
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            color: var(--progress-bg); /* Default gray */
            font-weight: bold;
            transition: color 0.3s ease;
        }

        .progress-step.active .step-label {
            color: var(--step3-color); /* Blue for active step */
        }

        .progress-step.completed .step-label {
            color: var(--step1-color); /* Green for completed steps */
        }

        .hardcoded-note {
            font-style: italic;
            color: #666;
            margin-top: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-left: 3px solid var(--primary-color);
        }

        .task-row {
            background-color: #e6f7ff !important;
            font-weight: bold;
        }

        .document-header {
            margin-bottom: 20px;
        }

        .document-header h2 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .document-section {
            margin-bottom: 20px;
        }

        .document-section h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }

        .risk-details {
            margin-bottom: 15px;
            padding-left: 15px;
        }

        .risk-details h4 {
            margin-bottom: 5px;
            color: var(--text-color);
        }

        .risk-details p {
            margin: 5px 0;
        }

        .specs-table {
            width: 100%;
            border-collapse: collapse;
        }

        .specs-table th, .specs-table td {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: left;
        }

        .specs-table th {
            background-color: #f2f2f2;
        }

        /* NUD Section Styling */
        .nud-entry {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .nud-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .nud-inputs {
                grid-template-columns: 1fr;
            }
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            margin-bottom: 5px;
            font-weight: bold;
        }

        .nud-section-input, .nud-risk-input {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
        }

        .remove-nud-btn {
            background-color: #ff4d4d;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .remove-nud-btn:hover {
            background-color: #e60000;
        }

        .nud-buttons {
            margin-top: 20px;
        }

        #addNudBtn {
            background-color: #f0f0f0;
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        #addNudBtn:hover {
            background-color: #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>DFS Document Generator</h1>
    </div>

    <div class="section welcome-section">
        <h2>Welcome to the DFS Document Generator</h2>
        <p>This tool helps you quickly create Design for Safety (DFS) documents by generating a comprehensive risk table based on your device selection and included components.</p>

        <h3>How to Use This Tool:</h3>
        <ol>
            <li><strong>Select a Device</strong> - Choose the device type you're creating a DFS document for</li>
            <li><strong>Choose Device Type</strong> - For tablets, specify if it's a standard or KET device</li>
            <li><strong>Select Components</strong> - Check all the components included in your device</li>
            <li><strong>Add Unique Features</strong> - Add any new unique design features requiring safety consideration</li>
            <li><strong>Generate Document</strong> - Create your DFS document with all relevant risks</li>
            <li><strong>Copy to Quip</strong> - Copy the generated table and paste it into your Quip document</li>
        </ol>

        <p><strong>Note:</strong> Some safety risks are automatically included for tablet devices as they are standard requirements.</p>
    </div>

    <!-- Updated progress indicator with fill animation -->
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-bar-fill" id="progressBarFill"></div>
        </div>
        <div class="progress-steps">
            <div class="progress-step active" id="step1">
                <div class="step-circle">1</div>
                <div class="step-label">Select Device</div>
            </div>
            <div class="progress-step" id="step2">
                <div class="step-circle">2</div>
                <div class="step-label">Choose Components</div>
            </div>
            <div class="progress-step" id="step3">
                <div class="step-circle">3</div>
                <div class="step-label">Generate Document</div>
            </div>
        </div>
    </div>

    <div class="section" id="deviceSection">
        <div class="section-title">
            <span class="step-number">1</span>
            <h2>What device are you creating a DFS document for?</h2>
        </div>
        <div class="device-option" data-device="tablet">Tablet</div>
        <div class="device-option" data-device="ereader">E-Reader</div>
        <div class="device-option" data-device="hearable">Hearable</div>
        <div class="device-option" data-device="wearable">Wearable</div>
        <div class="device-option" data-device="efd">EFD</div>
    </div>

    <div class="section hidden" id="deviceTypeSection">
        <div class="section-title">
            <span class="step-number">1.5</span>
            <h2>Select Device Type</h2>
        </div>
        <select id="deviceTypeDropdown" class="device-type-dropdown">
            <option value="non-ket">Non-KET</option>
            <option value="ket">KET</option>
        </select>
    </div>

    <div class="section hidden" id="componentSection">
        <div class="section-title">
            <span class="step-number">2</span>
            <h2>Does the device include these components?</h2>
        </div>
        <div id="componentOptions" class="checkbox-grid">
            <!-- Component options will be populated based on selected device -->
        </div>
        <div class="hardcoded-note">
            Note: Some safety risks are automatically included for tablet devices regardless of component selection.
        </div>
        <div class="action-buttons">
            <button id="selectAllBtn">Select All</button>
            <button id="clearAllBtn">Clear All</button>
            <button id="generateBtn" class="primary-button">Continue to NUD Section</button>
        </div>
    </div>

    <div class="section hidden" id="nudSection">
        <div class="section-title">
            <span class="step-number">2.5</span>
            <h2>NUD - New Unique Design Features</h2>
        </div>
        <p>For this device, is there any new unique feature or aspect that requires safety consideration?</p>

        <div id="nudEntries">
            <!-- Initial entry -->
            <div class="nud-entry">
                <div class="nud-inputs">
                    <div class="input-group">
                        <label for="nudSection0">Product Section:</label>
                        <input type="text" id="nudSection0" class="nud-section-input" placeholder="e.g., Mechanical, Electrical, etc.">
                    </div>
                    <div class="input-group">
                        <label for="nudRisk0">Risk Topic:</label>
                        <input type="text" id="nudRisk0" class="nud-risk-input" placeholder="Describe the potential safety risk">
                    </div>
                </div>
                <button class="remove-nud-btn" data-index="0">Remove</button>
            </div>
        </div>

        <div class="action-buttons nud-buttons">
            <button id="addNudBtn">+ Add Another Unique Feature</button>
            <button id="continueFromNudBtn" class="primary-button">Generate DFS Document</button>
        </div>
    </div>

    <div class="section hidden" id="resultSection">
        <div class="section-title">
            <span class="step-number">3</span>
            <h2>Generated DFS Document</h2>
        </div>
        <div id="documentContent"></div>
        <div class="quip-options">
            <button id="downloadBtn">Download HTML</button>
            <button id="copyBtn" class="primary-button">Copy Document to Clipboard</button>
            <span id="copySuccess">✓ Copied!</span>
        </div>
        <div class="instructions">
            <h4>How to Use with Quip:</h4>
            <ol>
                <li>Click "Copy Document to Clipboard" above (you'll see a checkmark when successful)</li>
                <li>Open Quip in your browser and create a new document</li>
                <li>Click where you want to insert the document</li>
                <li>Paste the content (Ctrl+V or Cmd+V)</li>
                <li>The document should appear with proper formatting in your Quip document</li>
            </ol>
            <p><a href="https://quip.com/" target="_blank">Click here to open Quip in a new tab</a></p>
        </div>
    </div>

    <!-- Link buttons at the bottom of the page -->
    <div class="link-buttons">
        <a href="https://wiki.labcollab.net/confluence/display/RELIABILITY/DFS+Reviews+Respository" target="_blank" class="link-button">
            DFS Document Repository
        </a>
        <a href="https://wiki.labcollab.net/confluence/pages/viewpage.action?pageId=3111744869" target="_blank" class="link-button">
            DFS Automation Workflow
        </a>
    </div>

    <!-- Hidden textarea for copying -->
    <textarea id="tempTextArea"></textarea>

    <script>
        // Store selected device and type
        let selectedDevice = '';
        let selectedDeviceType = 'non-ket';

        // Update progress bar - UPDATED to include fill animation and step completion
        function updateProgress(step) {
            const steps = document.querySelectorAll('.progress-step');
            const progressBarFill = document.getElementById('progressBarFill');

            // Calculate progress percentage
            let progressPercentage;
            if (step === 2.5) {
                progressPercentage = 75; // 75% for the intermediate step
            } else {
                progressPercentage = ((step - 1) / (steps.length - 1)) * 100;
            }

            progressBarFill.style.width = `${progressPercentage}%`;

            // Update step styling
            steps.forEach((stepEl, index) => {
                stepEl.classList.remove('active', 'completed');
                if (index + 1 < step) {
                    stepEl.classList.add('completed');
                } else if (index + 1 === Math.floor(step)) {
                    stepEl.classList.add('active');
                }
            });
        }

        // Device selection
        document.querySelectorAll('.device-option').forEach(option => {
            option.addEventListener('click', function() {
                // Remove selected class from all options
                document.querySelectorAll('.device-option').forEach(opt => {
                    opt.classList.remove('selected');
                });

                // Add selected class to clicked option
                this.classList.add('selected');

                // Store selected device
                selectedDevice = this.getAttribute('data-device');

                // Show device type dropdown only for tablet
                if (selectedDevice === 'tablet') {
                    document.getElementById('deviceTypeSection').classList.remove('hidden');
                } else {
                    document.getElementById('deviceTypeSection').classList.add('hidden');
                    selectedDeviceType = 'non-ket';
                }

                // Update component options based on selected device
                updateComponentOptions(selectedDevice, selectedDeviceType);

                // Show component section
                document.getElementById('componentSection').classList.remove('hidden');

                // Hide NUD and result sections if visible
                document.getElementById('nudSection').classList.add('hidden');
                document.getElementById('resultSection').classList.add('hidden');

                // Update progress
                updateProgress(2);
            });
        });

        // Device type dropdown change
        document.getElementById('deviceTypeDropdown').addEventListener('change', function() {
            selectedDeviceType = this.value;
            updateComponentOptions(selectedDevice, selectedDeviceType);
        });

        // Function to update component options based on selected device
        function updateComponentOptions(device, deviceType) {
            const componentOptionsContainer = document.getElementById('componentOptions');
            componentOptionsContainer.innerHTML = ''; // Clear existing options

            // Get components for the selected device
            const components = getComponentsForDevice(device, deviceType);

            // Create checkbox for each component
            components.forEach(component => {
                const componentDiv = document.createElement('div');
                componentDiv.className = 'component-option';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = component.value;
                checkbox.name = 'component';
                checkbox.value = component.value;

                const label = document.createElement('label');
                label.htmlFor = component.value;
                label.textContent = component.label;

                componentDiv.appendChild(checkbox);
                componentDiv.appendChild(label);
                componentOptionsContainer.appendChild(componentDiv);
            });
        }

       // Function to get components for a specific device
function getComponentsForDevice(device, deviceType) {
    // Define components for each device type
    const deviceComponents = {
        tablet: [
            { value: 'display', label: 'Display' },
            { value: 'sharpEdges', label: 'Potential Sharp Edges' },
            { value: 'chargingPort', label: 'Charging Port' },
            { value: 'speaker', label: 'Speaker' },
            { value: 'battery', label: 'Battery' },
            { value: 'waterResistance', label: 'Water Resistance' },
            { value: 'repairableComponents', label: 'Repairable Components' }
        ],
        ereader: [
            { value: 'battery', label: 'Battery' },
            { value: 'physicalDesign', label: 'Physical Design' },
            { value: 'chargingPort', label: 'Charging Port' },
            { value: 'thermalCircuitConcerns', label: 'Thermal & Circuit Concerns' },
            { value: 'complianceEnvironmentalPolicies', label: 'Compliance & Environmental Policies' }
        ],
        hearable: [
            { value: 'waterResistance', label: 'Water Resistance' },
            { value: 'thermalCircuitConcerns', label: 'Thermal & Circuit Concerns' },
            { value: 'battery', label: 'Battery' },
            { value: 'chargingPort', label: 'Charging Port' },
            { value: 'caseEnclosure', label: 'Charging Case' },
            { value: 'sensors', label: 'Sensors' }
        ],
        wearable: [
            { value: 'battery', label: 'Battery' },
            { value: 'waterResistance', label: 'Water Resistance' },
            { value: 'skinContact', label: 'Skin Contact & Comfort' },
            { value: 'chargingSystem', label: 'Charging System' },
            { value: 'electrical', label: 'Electrical' },
            { value: 'thermal', label: 'Thermal' },
            { value: 'complianceEnvironmentalPolicies', label: 'Compliance & Environmental Policies' }
        ],
        efd: [
            { value: 'rockerSwitch', label: 'Rocker Switch' },
            { value: 'muteButton', label: 'Mute Button' },
            { value: 'lubricant', label: 'Lubricant Materials' },
            { value: 'moldedParts', label: 'Molded Parts' },
            { value: 'deviceIngress', label: 'Device Ingress Protection' },
            { value: 'display', label: 'Display/LCD' },
            { value: 'usbPort', label: 'USB-C Port' },
            { value: 'powerAdapter', label: 'Power Adapter' },
            { value: 'magneticMount', label: 'Magnetic Mount' },
            { value: 'ledIndicators', label: 'LED Indicators' },
            { value: 'speaker', label: 'Speaker' },
            { value: 'battery', label: 'Battery' },
            { value: 'thermalManagement', label: 'Thermal Management' },
            { value: 'compliance', label: 'Compliance & Certification' }
        ]
    };

    // Add KET-specific components if applicable
    if (device === 'tablet' && deviceType === 'ket') {
        return [
            ...deviceComponents.tablet,
            { value: 'ketSpecific', label: 'KET-Specific Components' }
        ];
    }

    return deviceComponents[device] || [];
}

        // Select/Clear All buttons
        document.getElementById('selectAllBtn').addEventListener('click', function() {
            document.querySelectorAll('input[name="component"]').forEach(checkbox => {
                checkbox.checked = true;
            });
        });

        document.getElementById('clearAllBtn').addEventListener('click', function() {
            document.querySelectorAll('input[name="component"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        });

        // Modify the Generate button to show NUD section
        document.getElementById('generateBtn').addEventListener('click', function() {
            // Show NUD section
            document.getElementById('nudSection').classList.remove('hidden');

            // Update progress - now we're at step 2.5
            updateProgress(2.5);

            // Scroll to NUD section
            document.getElementById('nudSection').scrollIntoView({ behavior: 'smooth' });
        });

        // Add event listener for adding new NUD entries
        document.getElementById('addNudBtn').addEventListener('click', function() {
            addNewNudEntry();
        });

        // Add event listener for the continue button in NUD section
        document.getElementById('continueFromNudBtn').addEventListener('click', function() {
            // Get selected components
            const selectedComponents = [];
            document.querySelectorAll('input[name="component"]:checked').forEach(checkbox => {
                selectedComponents.push(checkbox.value);
            });

            // Get NUD entries
            const nudEntries = getNudEntries();

            // Generate document content
            const documentContent = generateDFSDocument(selectedDevice, selectedDeviceType, selectedComponents, nudEntries);

            // Display document content
            document.getElementById('documentContent').innerHTML = documentContent;
            document.getElementById('resultSection').classList.remove('hidden');

            // Update progress
            updateProgress(3);

            // Scroll to result section
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        });

        // Function to add a new NUD entry
        function addNewNudEntry() {
            const nudEntries = document.getElementById('nudEntries');
            const entryCount = nudEntries.children.length;

            const newEntry = document.createElement('div');
            newEntry.className = 'nud-entry';
            newEntry.innerHTML = `
                <div class="nud-inputs">
                    <div class="input-group">
                        <label for="nudSection${entryCount}">Product Section:</label>
                        <input type="text" id="nudSection${entryCount}" class="nud-section-input" placeholder="e.g., Mechanical, Electrical, etc.">
                    </div>
                    <div class="input-group">
                        <label for="nudRisk${entryCount}">Risk Topic:</label>
                        <input type="text" id="nudRisk${entryCount}" class="nud-risk-input" placeholder="Describe the potential safety risk">
                    </div>
                </div>
                <button class="remove-nud-btn" data-index="${entryCount}">Remove</button>
            `;

            nudEntries.appendChild(newEntry);

            // Add event listener for the remove button
            newEntry.querySelector('.remove-nud-btn').addEventListener('click', function() {
                nudEntries.removeChild(newEntry);
            });
        }

        // Function to get all NUD entries
        function getNudEntries() {
            const entries = [];
            const nudEntries = document.getElementById('nudEntries').children;

            for (let i = 0; i < nudEntries.length; i++) {
                const entry = nudEntries[i];
                const sectionInput = entry.querySelector('.nud-section-input');
                const riskInput = entry.querySelector('.nud-risk-input');

                if (sectionInput.value.trim() !== '' && riskInput.value.trim() !== '') {
                    entries.push({
                        section: sectionInput.value.trim(),
                        topic: riskInput.value.trim()
                    });
                }
            }

            return entries;
        }

        // Add event delegation for remove buttons
        document.getElementById('nudEntries').addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-nud-btn')) {
                const entryToRemove = e.target.closest('.nud-entry');
                if (entryToRemove) {
                    entryToRemove.remove();
                }
            }
        });

        // Helper function to format control plan with proper bullet points
        function formatControlPlan(controlPlanText) {
            if (!controlPlanText) return '';

            // Split by line breaks
            const lines = controlPlanText.split('\n');
            let formattedText = '';

            // Remove "Control Plan:" from the beginning if it exists
            if (lines.length > 0 && lines[0].trim().startsWith('Control Plan:')) {
                // Remove the first line if it's just "Control Plan:"
                if (lines[0].trim() === 'Control Plan:') {
                    lines.shift();
                } else {
                    // Otherwise, remove the "Control Plan:" prefix from the first line
                    lines[0] = lines[0].substring('Control Plan:'.length).trim();
                }
            }

            // Process each line
            lines.forEach(line => {
                if (line.trim().startsWith('Control Plan -')) {
                    // This is a section header
                    formattedText += `<li><strong>${line.trim()}</strong></li>`;
                } else if (line.trim().startsWith('*')) {
                    // This is a bullet point
                    formattedText += `<li style="margin-left: 20px;">${line.trim().substring(1).trim()}</li>`;
                } else if (line.trim()) {
                    // This is regular text
                    formattedText += `<li>${line.trim()}</li>`;
                }
            });

            return formattedText;
        }

        // Function to generate DFS document with complete template
        function generateDFSDocument(device, deviceType, components, nudEntries = []) {
            const deviceName = getDeviceDisplayName(device, deviceType);
            const today = new Date().toLocaleDateString();

            // Get all risks for the device
            const allRisks = getAllRisks(device, deviceType, components, nudEntries);

            // Start building the document content
            let content = `
            <h2>Design for Safety</h2>

            <h3>Executive summary</h3>
            <p>Add summary here.</p>

            <h3>1. Product Introduction</h3>
            <p>Add summary here</p>

            <h3>2. Product Benchmarking Table (To be updated)</h3>
            <p>Capsule<br>Charger</p>

            <h3>3. Product Features and Specs</h3>
            <h4>3.1 Capsule: Description</h4>
            <table class="specs-table">
                <tr>
                    <th>ITEM</th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
                <tr><td>DISPLAY</td><td></td><td></td><td></td><td></td></tr>
                <tr><td>HAPTICS</td><td></td><td></td><td></td><td></td></tr>
                <tr><td>MICROPHONES</td><td></td><td></td><td></td><td></td></tr>
                <tr><td>CAPSULE SIZE</td><td></td><td></td><td></td><td></td></tr>
                <tr><td>CAPSULE WEIGHT</td><td></td><td></td><td></td><td></td></tr>
                <tr><td>CAPSULE MATERIAL</td><td></td><td></td><td></td><td></td></tr>
                <tr><td>SENSOR</td><td></td><td></td><td></td><td></td></tr>
                <tr><td>BATTERY CAPACITY, VOLTAGE</td><td></td><td></td><td></td><td></td></tr>
                <tr><td>BAND ATTACH MECHANISM</td><td></td><td></td><td></td><td></td></tr>
                <tr><td>BAND CLOSURE</td><td></td><td></td><td></td><td></td></tr>
                <tr><td>BAND MATERIAL</td><td></td><td></td><td></td><td></td></tr>
                <tr><td>CHARGER TYPE</td><td></td><td></td><td></td><td></td></tr>
                <tr><td>Water Resistance Requirements</td><td></td><td></td><td></td><td></td></tr>
            </table>

            <h4>3.2 Charger:</h4>
            <table class="specs-table">
                <tr>
                    <th>ITEM/ CATEGORY</th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
                <tr><td>CHARGER TYPE</td><td></td><td></td><td></td><td></td><td></td></tr>
                <tr><td>PRODUCT DIMENSIONS/ WEIGHT</td><td></td><td></td><td></td><td></td><td></td></tr>
                <tr><td>Cable Length</td><td></td><td></td><td></td><td></td><td></td></tr>
                <tr><td>Weight</td><td></td><td></td><td></td><td></td><td></td></tr>
                <tr><td>CHARGER SPECIFICATION</td><td></td><td></td><td></td><td></td><td></td></tr>
                <tr><td>EE SPECIFICATION/ RATING - charging speed?</td><td></td><td></td><td></td><td></td><td></td></tr>
                <tr><td>Connector type</td><td></td><td></td><td></td><td></td><td></td></tr>
                <tr><td>Pogo pin type</td><td></td><td></td><td></td><td></td><td></td></tr>
                <tr><td>HOUSING MATERIAL</td><td></td><td></td><td></td><td></td><td></td></tr>
                <tr><td>ACCESSORIES SPECIFICATION</td><td></td><td></td><td></td><td></td><td></td></tr>
            </table>

            <h3>Lessons Learned</h3>
            <h4>Safety Lessons Learned</h4>
            <p>PI Safety Lessons JIRA</p>
            <p>Wearable lesson learned:</p>
            <ul>
                <li>Silkscreen Replacement with Exposed Copper caused grounding on MLB PCB in DVT [ relevance score: 1.0 ]</li>
                <li>Lessons Learned from Metal Contact Corrosion in Wearable Devices [ relevance score: 1.0 ]</li>
                <li>Bruce Teardown Observations [ relevance score: 1.0 ]</li>
                <li>Bruce Capsule bridge (band attach area) cracking during Insertion / Removal Life cycle. [ relevance score: 1.0 ]</li>
                <li>Dylan grounding issue (resistance test) [ relevance score: 1.0 ]</li>
                <li>Dylan LL [ relevance score: 1.0 ]</li>
                <li>Avoid Electrolytic Corrosion in Connectors and Contacts [ relevance score: 1.0 ]</li>
                <li>Grounding Guidelines for wearables [ relevance score: 1.0 ]</li>
                <li>Lessons Learned from Metal Contact Corrosion in Wearable Devices [ relevance score: 1.0 ]</li>
            </ul>
            <p>AME team/Factory team LL: Bruce AME Lessons Learned</p>
            <p>REL team LL:</p>
            <p>Dylan lesson learned Dylan_LL_V7.pdf</p>
            <p>Wearable corrosion lesson learned</p>

            <h3>Product PD Review</h3>
            <p>Design architecture:</p>
            <p>PD related process issue</p>

            <h3>Product EE Review</h3>
            <p>Device power architecture</p>
            <p>EE related process issue</p>

            <h3>Safety Risk Summary Table</h3>
            <table>
                <thead>
                    <tr>
                        <th>Product Section</th>
                        <th>ID</th>
                        <th>Risk Topic</th>
                        <th>Justification</th>
                        <th>Functional Team</th>
                        <th>Assignee</th>
                        <th>Risk Level</th>
                        <th>Design Milestone</th>
                        <th>Close-By Milestone</th>
                        <th>Control Plan/Validation Plan</th>
                    </tr>
                </thead>
                <tbody>`;

            // Add mandatory task row
            content += `<tr class="task-row">
                <td>Task</td>
                <td>0.1</td>
                <td>DFS doc review and legal sign-off</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>`;

            // Group risks by section for hierarchical numbering
            const risksBySection = {};
            allRisks.forEach(risk => {
                if (!risksBySection[risk.section]) {
                    risksBySection[risk.section] = [];
                }
                risksBySection[risk.section].push(risk);
            });

            // Add each risk to the table with hierarchical numbering
            let sectionCounter = 1;

            for (const section in risksBySection) {
                let itemCounter = 1;

                risksBySection[section].forEach(risk => {
                    // Generate hierarchical ID (e.g., 1.1, 1.2, 2.1, etc.)
                    const hierarchicalId = `${sectionCounter}.${itemCounter}`;

                    content += `<tr>
                        <td>${risk.section}</td>
                        <td>${hierarchicalId}</td>
                        <td>${risk.topic}</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td>${risk.riskLevel || ''}</td>
                        <td></td>
                        <td>EVT</td>
                        <td>${risk.controlPlanDetails || ''}</td>
                    </tr>`;

                    itemCounter++;
                });

                sectionCounter++;
            }

            // If no risks were added, add a placeholder row
            if (Object.keys(risksBySection).length === 0) {
                content += `<tr>
                    <td colspan="10" style="text-align: center;">No specific risks defined for this device type yet.</td>
                </tr>`;
            }

            content += `</tbody></table>`;

            // Add PD & Structural Safety Risk Details section
            content += `<h3>PD & Structural Safety Risk Details</h3>`;

            // Add each section with its risks
            for (const section in risksBySection) {
                content += `<h4>${section}</h4>`;

                // Add each risk topic with description, requirement, and control plan
                risksBySection[section].forEach(risk => {
                    content += `
                    <div class="risk-details">
                        <p><strong>Risk Topic:</strong> ${risk.topic}</p>

                        <p><strong>Description:</strong></p>
                        <ul>
                            <li>${risk.description || ''}</li>
                        </ul>

                        <p><strong>Requirement:</strong></p>
                        <ul>
                            <li>${risk.requirement || ''}</li>
                        </ul>

                        <p><strong>Control Plan:</strong></p>
                        <ul>
                            ${formatControlPlan(risk.controlPlanDetails || '')}
                        </ul>

                        <p><strong>Risk Estimation:</strong> ${risk.riskLevel || ''}</p>
                    </div>`;
                });
            }

            // Add Appendix
            content += `<h3>Appendix:</h3>`;

            return content;
        }

        // Function to get all risks based on device, device type, and selected components
        function getAllRisks(device, deviceType, selectedComponents, nudEntries = []) {
            let allRisks = [];

            // Only add hardcoded risks for tablets
            if (device === 'tablet') {
                const hardcodedRisks = getHardcodedRisks();
                allRisks = [...allRisks, ...hardcodedRisks];
            }

            // Then add risks for each selected component
            selectedComponents.forEach(component => {
                const componentRisks = getComponentRisks(device, deviceType, component);
                allRisks = [...allRisks, ...componentRisks];
            });

            // Add NUD entries if provided
            if (nudEntries && nudEntries.length > 0) {
                allRisks = [...allRisks, ...nudEntries];
            }

            return allRisks;
        }

        // Function to get hardcoded risks that apply to all devices
        function getHardcodedRisks() {
            return [
                {
                    section: "Electrical",
                    topic: "Single Fault Failures",
                    description: "A single fault failure is a failure of any single component in the EE design that causes abnormal power consumption resulting in temperature rise that can be perceived by user or exceed touch temperature limits on surfaces of the device. The failure itself may be caused due to the following situations: 1) Presence of a faulty electronic component, 2) Damage to the component from an external event like a dropping, water ingress, or lightning surge, 3) damage or pin bridges introduced by manufacturing process.",
                    requirement: "External customer accessible part of the device should not exceed its safe operating touch temperature.",
                    controlPlanDetails: "Control Plan - EE:\n* All components are supplied with PMIC or charger, which integrates hardware thermal OTP protection inside.\n* NTCs close to SoC, SD port, USB port, and charger IC on MLB to monitor PCB temperature.\n\nControl Plan - EE Integrity:\n* Reserved Yeti circuit for single fault protection.\n\nControl Plan - Thermal:\n* Calculate the maximum thermal power of single fault components and generate single fault power table.\n* Enable proper quantity of NTCs near the fault components that can cause temperature over TS2 spec based on simulation data.\n* Set reasonable threshold for NTCs to cut off power supply and prevent surface from overheat.\n* Validate in xVT tests.",
                    riskLevel: "Medium Risk"
                },
                {
                    section: "Electrical",
                    topic: "Protection backups to SoC OTP solution",
                    description: "Many OTP solutions are relying on SoC processing. In case of SoC hang or disabled, system has the risk of losing OTP controls. An example of such scenario, if the device is taken back from a special high temperature environment such as sun burned vehicle dashboard, the user is attempting to perform a reboot, then the SoC could be activated while nearing or exceeding its work temperature limit and hang.",
                    requirement: "Beside the thermal policy control, a primary OTP shall be implemented as a bottom-line protection in case of SoC control absence.",
                    controlPlanDetails: "Control Plan - EE:\n* SoC power is from PMIC. If SoC draws too much power when it hangs, the PMIC efficiency will drop dramatically, which means the PMIC temperature will rise quickly, it will trigger PMIC hardware thermal protection to shut down PMIC to stop power for SoC. Also SoC is placed close to PMIC on PCB, the thermal transferring to PMIC will accelerate the PMIC shutdown. Also PMIC has watchdog mechanism to reboot SoC if system hung is occurred.\n* PMIC will be overheated and its hardware thermal protection can shutdown power for SoC if SoC draws too much power from PMIC when it hangs.\n* SoC is placed close to PMIC on PCB, the thermal transferring to PMIC will accelerate the PMIC shutdown.\n* PMIC and charger integrated pure hardware thermal protection mechanism w/o SoC software involved.\n* PMIC and SoC platform integrated watchdog mechanism to avoid software issue caused by OTP, logic error etc.\n\nControl Plan - Thermal:\n* The SoC OTP will shut down the device when it detects the junction temperature over a certain value if SoC temperature rises gradually while it's working properly.\n* SoC may hang when starting up the device at a very high junction temperature whereas the temperature will not climb due to SoC power as it hangs instantly and will not provide much thermal load.\n* PMIC hardware OTP will shut down power supply to SoC and other components at 150C.\n\nControl Plan - EE Integrity:\n* Conduct ambient temperature heat soak DOE with 5 pcs [insert device name here] HVT device from 25C to 85C to confirm whether SoC can shut down as intended.",
                    riskLevel: "Medium Risk"
                },
                {
                    section: "Thermal",
                    topic: "Device surface temperature exceeds safety limit",
                    description: "Heavy device loading results in high chip temperature that subsequently leads to surface temperature rise that exceeds safety limit, causing user complaints, device return and even burn hazard.",
                    requirement: "At high loading and thermal policy single fault condition, surface temperature shall not exceed class 2 thermal energy source limit (70C for plastic and 66C for glass, TS2 of IEC62368) for high-touch handle devices (tablets, e-readers).",
                    controlPlanDetails: "Control Plan - Thermal:\n* At xVT, disable thermal policy and run device at high loading to ensure surface temperatures do not exceed TS2 limit under proper thermal design.\n* SoC will throttle power or shutdown device using temperature read from junction temperature sensors, despite thermal policy functions.",
                    riskLevel: "Medium Risk"
                },
                {
                    section: "Manufacturing",
                    topic: "Safety components & battery (if battery operated) damaged by improper assembly process",
                    description: "Device have safety relevant components and these components have possibility to be damaged by improper assembly process which may lead to device malfunction and may cause safety related issues.",
                    requirement: "All the FATP stations have SOPs to guide operators to assemble device to avoid potential damage to safety components and battery.",
                    controlPlanDetails: "Control Plan - MTM:\n* Huaqin has introduced auto-assembly for battery assembly.\n* Battery SRA pressing force will be controlled by fixture.",
                    riskLevel: "Medium Risk"
                },
                {
                    section: "Manufacturing",
                    topic: "Solder ball issue",
                    description: "A solder ball is the most common type of defect that occurs in the SMT assembly process which leads to potential short or undesired compression to battery. Solder balling can be caused by poor process conditions with gassing from the flux during wave contact or excessive turbulence as the solder flows back into the bath which causes spitting. Solder balls can be ejected from the joint area during soldering due to excessive outgassing of the PCB.",
                    requirement: "No solder ball larger than 0.1 mm is allowed.\nValid solder ball detection method is required on the production line.",
                    controlPlanDetails: "Control Plan - MTM:\n* SMT standard practice: controlled by stencil design and SPI/AOI control.",
                    riskLevel: "Low Risk"
                },
                {
                    section: "Safety Compliance",
                    topic: "Product Safety Compliance & Certification Requirements",
                    description: "Compliance to the applicable safety standard IEC60950 Ed.2 + Am.1 + Am.2, IEC62368-1 Ed. 2, and IEC62368-1 Ed. 3 IEC62668-1 Ed. 4 with National Deviations covering all the POR regions.",
                    requirement: "Design shall comply to a certification agency compliance assessment, in accordance to the applicable standards listed above.",
                    controlPlanDetails: "Control Plan:\n* HVT Phase - Construction Review + full safety pre-compliance testing to standards listed above.\n* Deliverable – Construction review letter, completed test data sheets.\n* EVT Phase – Construction Review (delta vs HVT) + full safety compliance testing to standards listed above.\n* Deliverable – CB Test Reports & Certificates per noted standards above.\n* DVT Phase - Construction Review (delta vs EVT) + regression safety compliance testing to standards listed above.\n* Deliverable - CB Test Reports & Certifications per noted standards above",
                    riskLevel: "Medium Risk"
                },
                {
                    section: "Environment Compliance",
                    topic: "Device material causes harmful effects to human or environment",
                    description: "Lab126, Ring, Blink, Key, Sidewalk (RBKS), and Kuiper branded products, including packaging and batteries (where applicable) must meet the general Environmental Compliance (EC) requirements to comply with the respective regional, national or local environmental laws and regulations where they are put on the market.\nFor regulations that are already adopted, detailed compliance requirements and substance limits are described in the Amazon Devices and Services Restricted and Reportable Substance List (Amazon Devices RSL), PN: 05-003018 and Amazon Supplier Declaration of Compliance (SDoC), PN: 05-030181.\n\n* EC requirements to meet restricted substance laws and regulations applicable to most products globally: (For complete list of impacting regulations, please refer to Amazon Devices RSL)\n* EU RoHS (Restriction of Hazardous Substances Directive 2011/65/EU)\n* EU REACH (Registration, Evaluation Authorization and Restriction of Chemicals Regulation No. 1907/2006)\n* EU POPs (Persistent Organic Pollutants Regulation No. 2019/1021)\n* EU PCKG (Packaging and Packaging Waste Directive 94/62/EC; Annex II, Par.1)\n* EU BATT (Batteries and Accumulators and Waste Batteries and Accumulators Regulation (EU) 2023/1542)\n* US TSCA (Toxic Substance Control Act)\n* Prop 65 (California Safe Drinking Water and Toxic Enforcement Act)\n* CEPA (Canadian Environmental Protection Act, 1999)\n* OFR regulations such as NY and WA OFR – HTC link to be only shared Amazon internal: https://amazon.awsapps.com/workdocs-preview/index.html#/folder/9ef8b0e49a47687962d44280357d1286d62d5e3ec337deb91469403c56a1a3e0\n* PFAS regulations such as CA PFAS, EPA TSCA – HTC link to be only shared Amazon internal: https://amazon.awsapps.com/workdocs-preview/index.html#/folder/9ef8b0e49a47687962d44280357d1286d62d5e3ec337deb91469403c56a1a3e0\n* EC DoC required if product is imported into and made available for sale in the following country(ies):\n* India RoHS (E-waste Management and Handling Rules 2016, Chapter V, sub-rule (1) of Rule 16)\n* EC certification requirements only applicable if product is imported into the respective country for sale:\n* UAE RoHS (UAE Cabinet Decision No. 10/2017, Testing and Certification),\n* KSA RoHS (SASO Technical Regulation for Restriction of Hazardous Substances in Electrical and Electronic Equipment)\n* For suppliers with product manufacturing or assembly processes in China:\n* China VOC (Limits for Volatile Organic Compounds) Regulation related to national requirements for VOC content in adhesives, coatings, inks and cleaning agents during manufacturing\n\nSuppliers are responsible for validating and ensuring that material composition and supporting documents for the parts/components/products that they supply to Amazon meet the requirements of applicable EC laws and regulations.",
                    requirement: "",
                    controlPlanDetails: "Control plan - EC:\n* Ask CM to complete the compliance documents collection before PVT RR. EC team will provide the risk level for the DVTRR and PVTRR. The compliance documents may include:\n* Signed SDoC (Supplier Declaration of Conformity) document # 05-030181 from suppliers.\n* Full Material Disclosures (\"FMD\") should be provided for all external, user accessible parts from each part supplier, if multiple sourced, for PROP 65 (California substance exposure regulation) compliance verification. Amazon recommends the use of Amazon FMD template 05-038004.\n* Halogen Test Report for all external, user accessible parts from each part supplier, if multiple sourced.\n* Other 3rd Party Lab test reports base on the BOM\n* Material Safety Datasheets (MSDS), if applicable\n* Arrange the EC testing if needed and provide the update to the project team and/or supplier requesting additional information (as needed).",
                    riskLevel: "Medium Risk"
                },
                {
                    section: "Packaging",
                    topic: "Device and/or components damaged during transit",
                    description: "A customer might receive a product and/or accessories damaged during transit that may cause safety issues to the customer (e.g. broken glass screens/bent corners causing sharp edges, damaged internal components, etc..)",
                    requirement: "The product must pass bare product reliability tests.\nThe packaged product and accessories must not have severe damage that may cause safety issues to the customer after package transit testing.\nThe in-box documentation, safety markings and safety information must not have severe damage that may lead to improper use or illegibility of such warnings.",
                    controlPlanDetails: "Control Plan - PKG:\n* Packaging transit testing to be conducted at each xVT-stage. Refer to 05-009415 Packaging Transit Test Standards and 05-029425 post CET inspection criteria\n\nControl Plan - REL:\n* Reliability test will be conducted at each xVT-stage to monitor the risk(e.g. broken glass screens/bent corners causing sharp edges, damaged internal components, etc..) under mechanical impact.",
                    riskLevel: "Medium Risk"
                },
                {
                    section: "Consumer Misuse",
                    topic: "Misuse high watt power adapter",
                    description: "A customer could have a fair possibility to use a non-Amazon power adapter to charge the device which may over draw if a mismatched or even a non compliance adapter offers higher voltage. This over-limit voltage may damage the charge IC and components on the path, poses potential safety risks.",
                    requirement: "[insert device name here] shall have OVP feature to withstand charging voltage up to 28V DC (the highest charging DC voltage under USB-C connection on the market).",
                    controlPlanDetails: "Control Plan - Software:\n* After Vbus exceed 6.5V for normal 5V charging or 12V for PD 9V charging, software will turn off charging to safe device from over voltage, confirmed by charger SW owner.\n\nControl Plan - EE:\n* [insert device name here] charger IC and load switch on VBUS is able to withstand 22V[base] and 28V[plus] DC voltage respectively. 22V is base spec defined in SOW.\n\nControl Plan - Reliability:\n* Connect [insert device name here] USB-C port with 28V DC power to verify its OVP protection on charge IC in HVT to cover the risk of using a non compliance adapter.\n\nControl Plan - Written Instructions:\n* Specifications of charger will be listed in the instructions. Safety instructions to include warnings regarding not using non-OEM power adapter to charge the device.",
                    riskLevel: "Medium Risk"
                }
            ];
        }

        // Function to get risks for a specific component
        function getComponentRisks(device, deviceType, component) {
            // Define component risks for tablets
            const tabletComponentRisks = {
                display: [
                    {
                        section: "Product Design Structural",
                        topic: "Sharp fracture due to mechanical impact (Display, Rear housing)",
                        description: "Tablet's display and rear housing are prone to blunt object impacts in a variety of different scenarios which include objects (such as keys) being dropped onto a device, and a device crashing into objects (such as door knobs and table corners). Screen or rear housing has the possibility to crack during these user scenarios. The crack may cause sharp fractures which could cause injury issue to user by skin contact.",
                        requirement: "[insert device name here] should pass ball impact/drop/tumble test to verify that it can withstand mechanical impacts in the field as reliability requirements defined. Sharp fractures caused by mechanical impact to the display cannot cause injury issue to user by unconsciously skin contact.",
                        controlPlanDetails: "Control Plan - PD:\n* The rear housing is aluminum with 1.2mm sidewall and 0.6mm bottom thickness which can bear the drop force and prevent material crack. The display is protected by rear housing rim to prevent direct hitting from edge drop, however the display CG will be 0.15mm higher in worst case and will be a risk in mechanical test and need simulation and risk assessment.\n\nControl Plan - Display ME:\n* Edge polishing can be a DOE to enhance the strength of the cover glass, as the device step reduction has led to less protection for the cover glass.\n* Mechanical simulation from CM has been applied before PD tooling kickoff to evaluate whether any risks.\n* Mechanical match will be applied with PD to double check if any interference matching with PD MF and RH parts.\n\nControl Plan - Reliability:\n* Monitor sharp fracture during xVT reliability tests.",
                        riskLevel: "Medium Risk"
                    },
                    {
                       section: "Display",
                        topic: "Liquid crystal material leakage after LCD screen cracking",
                        description: "Tablet LCD substrate is glass, which may be cracked when a tablet device is dropped or impacted by strong mechanical force. Since there is liquid crystal material inside LCD, external force may crack LCD substrates and cause liquid crystal material leakage. It may pose toxic hazard if user can access the leaked liquid crystal.",
                        requirement: "User should not have access to the liquid crystal even if the LCD is cracked accidentally.",
                        controlPlanDetails: "Control Plan - Display HW:\n* LCD in [insert device name here] device is underneath cover glass. Therefore customers cannot touch liquid crystal material even if LCD glass is cracked.\n\nControl Plan - Disposal Instructions:\n* WEEE marking; Provide instructions regarding disposal of device per the local ordinances and requirements.",
                        riskLevel: "Low Risk"
                    }
                ],
                sharpEdges: [
                    {
                        section: "Product Design Structural",
                        topic: "Sharp edge features",
                        description: "Device has sharp edges and very small corner radius can make usage inconvenient. Sharp edges and corners may cause injury issue to user by skin contact and hamper the customer experience overall.",
                      requirement: "These are the generic design guideline for corner radius [C] and top/ bottom edge radius [E]: If corner radius [C] is less than 2.5mm, the top/ bottom edge radius [E] should be at least 0.3 mm. If corner radius [C] is more than 2.5mm, the top/ bottom edge radius [E] should be at least 0.1 mm. Minimum radius for corner radius should be at least 0.3 mm.",
                        controlPlanDetails: "Control Plan - PD:\n* [insert device name here] exterior geometry follows ID design with 1.2mm edge radius, button edge radius 0.15mm fulfill the requirement.\n\nControl Plan - Display:\n* There is 0.1mm chamfer on the display edge to avoid injury to user.",
                        riskLevel: "Medium Risk"
                    }
                ],
                chargingPort: [
                    {
                        section: "Electrical",
                        topic: "Liquid ingress on USB-C port",
                        description: "Tablet device can be exposed to various of liquid contact and spill. Liquid can easily build up in/on power ports, posing short related risks. Liquid detection function can warn user that USB-C port occurs liquid immersion issue, and also can stop charging automatically if the device is connected with a charging cable.",
                        requirement: "Device will detect liquid ingression into USB-C port and prevent any damage to system due to liquid presence.\nCustomer shall be notified via SW promotion to take appropriate corrective action to prevent the device from further liquid exposure. Same as Tungsten and Sunstone.\nBFT and FATP check liquid detect function of the PCBA and device.",
                        controlPlanDetails: "Control Plan - PD:\n* Designed a novel USB component with two additional liquid detection pins to improve the detection accuracy.\n\nControl Plan - EE Integrity:\n* New liquid detection circuit of MT6375 will be used for [insert device name here]. Need to verify at xVT.\n* For USB-C, new FW from MTK will be used. Need to verify at xVT.\n\nControl Plan - MTM:\n* We have sweat test in BFT (board level test) which is a simulation test and needs test points. No test will be in FATP.\n\nControl Plan - Reliability:\n* Reliability will conduct liquid detection test (sweat/water/gatorade) in xVT to verify USB-C liquid detection function.",
                        riskLevel: "Medium Risk"
                    }
                ],
                speaker: [
                    {
                        section: "Electrical",
                        topic: "Speaker heating risk",
                        description: "Tablet device may have liquid ingress. Liquid may short the audio amplifier input circuit and cause DC bias on speaker. This will cause speaker heating. The temp of the tablet surface may exceed TS2 at this scenario.",
                        requirement: "External customer accessible part of the device should not exceed its safe operating touch temperature.",
                        controlPlanDetails: "Control Plan - EE/EE Integrity:\n* Add DC detection circuit for [insert device name here]. This can cut off the power of speaker when DC bias presented on speaker.\n\nControl Plan - Thermal:\n* Validate DC detection circuit to ensure device temperature near speaker below TS2 when there is DC bias\n* Test the max surface temp when DC bias is applied on the speaker.\n* explore to build correlation between NTC temp and speaker/surface when DC bias occurred.\n* Have thermal solutions(such as speaker graphite or copper foil) as backup in case other mitigations won't suffice.",
                        riskLevel: "Medium Risk"
                    }
                ],
                battery: [
                    {
                        section: "Battery",
                        topic: "Device Battery Overcharged",
                        description: "The battery can become overcharged if: (1) The taper current cutoff too low; (2) The PCM fails to protect in single fault scenario; (3) The charge voltage setting too high.",
                        requirement: "Taper current must not go lower than minimum specified in the cell spec.\nCharge voltage must not go above the absolute maximum voltage allowed by the cell spec.\nPCM fails to protect in single fault scenario—does not apply as that is a double fault scenario.\nInclude battery safety and stress reduction daemon software to monitor battery state and de-rate battery top of charge on battery stress detection, disable charging on battery fault detection. See FW Integrity's battery SW design spec, Agile PN 05-043290.",
                        controlPlanDetails: "Control Plan-Battery Integrity:\n* Taper current setting is aligned with the battery specs with tolerances. No top off charging is allowed to prevent over charge conditions under no SW control scenarios.\n* Battery SW control on all registers will be validated in HVT and EVT. If SW is not available by HVT, additional validation will be done at DVT.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Battery",
                        topic: "Battery jelly-roll shift post device drop/tumble",
                        description: "The jelly-roll inside battery should not have huge shift during drop/tumble.",
                        requirement: "The electrolyte amount should be balanced with the overall drop performance.\nAdd hot melt tape and anti-telescoping tape to the jellyroll",
                        controlPlanDetails: "Control Plan-Battery Engineer:\n* The adhesive used to fix the jelly-roll is hot melt glue instead of single side glue.\n* The separator used is high-adhesive and bottom tape is added to prevent the free electrolyte from flushing the separator and cause separator shift.\n\nControl Plan - REL:\n* Reliability team will perform extended drop and tumble tests for all versions including KET and MER at each xVT stages to monitor the performance.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Battery",
                        topic: "Battery EEPROM data is corrupted",
                        description: "The battery's EEPROM is a new component, and new sources of errors may cause data corruption.\nData corruption leads to malfunctioning safety algorithms (e.g., dynamic stress reduction algorithm) and loss of data for FA (e.g., BSN, date of first use, cycle count).",
                        requirement: "The software shall implement mitigations to detect and correct basic data corruption.",
                        controlPlanDetails: "Control Plan-SW:\n* The Software Design Specification for Li-Ion Battery Systems spec from System Integrity (Agile 05-046397) is in the BRD and mandates the implementation of EEPROM error handling by leveraging data backups on the MLB.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Battery",
                        topic: "Battery swelling due to 4.48V Chemistry",
                        description: "Battery swelling is generated by gas generation due to the cell being at high voltages. The longer it is held at these higher voltages, more gas will be generated and the battery will swell quicker.",
                        requirement: "Implement pre-existing dynamic stress reduction algorithm\nSuccess Criteria:\n* Using the stress reduction algorithm, a derating strategy must be generated meeting the following BRD requirements:\n* Battery gaseous swelling must be contained to 200 dppm in 5 years\n* No derating of battery for TP95 of population in 3 years of use.\n* No derating for TP95 of population over 5 years that reflects more than 10% loss of capacity.",
                        controlPlanDetails: "Control Plan - Battery Integrity:\n* Characterize Paloma DOE and POR batteries for swelling using accelerated swell testing methodology\n* Develop a swell model for both to understand the swell behavior at different temperature and voltage conditions\n* Develop a derating strategy that meets BRD requirements and implement the derating strategy for Paloma aboard the dynamic stress reduction algorithm\n* This will likely take place during DVT due to long duration of testing\n* Validate Paloma's dynamic stress reduction algorithm with the firmware integrity team",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Battery",
                        topic: "USB connector intermittently connects and re-connects causing charging to start and stop constantly",
                        description: "USB connector intermittently connects and re-connects causing charging to start and stop constantly. This can lead to thermal runaway and accelerated battery swell and degradation.",
                        requirement: "Only recharge the battery when battery is significantly discharged or USB is disconnected for long period of time.",
                        controlPlanDetails: "Control Plan-Battery Integrity:\n* Implement learnings from Trona and onboard 7 day pull down.\n* Onboard Fast charge timer FW feature with debounce setting of 60 seconds to avoid recharging due to short USB disconnect/reconnect events.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Reliability",
                        topic: "Battery delamination/damage post mechanical impact/shock",
                        description: "The battery used in [insert device name here] has the weight of 103g with 6860mAh capacity. Battery has the risk of delaminating from the device hitting adjacent PCBA or housing after drop, tumble or other mechanical shock, causing safety risks to customers.",
                        requirement: "The battery must not de-laminate during extended drop + tumble testing",
                        controlPlanDetails: "Control Plan - Battery Integrity:\n* Quality data to be reviewed at each XVT-stage:\n* 180deg Peel Adhesion on PSA tape data must be reviewed with the MTS/AME/SQM engineer\n* 180deg Peel Adhesion on Release Liner must be reviewed with the MTS/AME/SQM engineer\n* Release force for liner aging data must be reviewed with the MTS/AME/SQM engineer\n* Loss of Adhesion data must be reviewed with the MTS/AME/SQM engineer\n* Silicon oil amount with XRF data must be reviewed with the MTS/AME/SQM engineer\n* Battery surface energy data needs to be reviewed with the MTS/AME/SQM engineer\n\nControl Plan - REL:\n* Reliability team will perform extended drop and tumble tests for all versions including KET and MER at each xVT stages to monitor the performance.",
                        riskLevel: "Medium Risk"
                    }
                ],
                waterResistance: [
                    {
                        section: "Consumer Misuse",
                        topic: "Misuse device after water soak",
                        description: "For [insert device name here] KET/MER version, a child may continue to use the device which got soaked in water. There is a chance that water seeps in and causes short circuits in the components, leading to further overheating, which pose a risk of burn to the user.",
                        requirement: "Customers should be clear noted with reminders or warnings to avoid using devices after severe water soak.",
                        controlPlanDetails: "Control Plan - Written Instructions:\n* Instructions of not exposing devices to liquid and using devices under wet conditions will be included in the in-box document to warn customers of associated risks.\n\nControl Plan - EE:\n* Liquid detection function can warn user that USB-C port occurs liquid immersion issue, and also can stop charging automatically if the device is connected with a charging cable.\n\nControl Plan - Reliability:\n* Conduct DoE tests in xVT for [insert device name here] KET/MER to inspect whether water soak will induce severe overheating risks.",
                        riskLevel: "Medium Risk"
                    }
                ],
                repairableComponents: [
                    {
                        section: "Repairability",
                        topic: "Safety concern from device repair",
                        description: "Per EU Eco design regulation, customers have the possibility to replace the display of the device. During the disassembly or assembly, there is a chance that battery is damaged, which poses a safety concern.",
                        requirement: "The device design should be optimized to reduce the likelihood of damage to the battery or other critical components, and clear assembly and disassembly guideline should be defined and provided to customers.",
                        controlPlanDetails: "Control Plan - PD:\nRoselite follows the regular design approaches for the device and component design with no special structures and the internal components are accessible after tearing down the display. The display is PSA-bonded in rear cover along the edge of housing. PCBA/SPK..etc. fastened by screws. Battery is PSA-bonded in rear cover.\n* Clearly define the guideline of display disassembly and assembly, including choosing the right tools and detailed display disassembly and assembly SOP (separating display, disconnecting FPC and reconnecting FPC).\n* Display is designed to be disassembled by two steps a) heat the display and b) use sucker to teardown the display(https://www.ifixit.com/products/isclack) or by thin pick which the tip of the pick should less than 5mm(recommended tool https://www.ifixit.com/products/iopener).\n* Regular screw driver is designed to disassemble PCBA and rest mechanical parts.\n* Recommend a tool with a magnetic function, which can reduce the risk of battery damage when users retrieve dropped parts (such as screws) into the battery compartment during disassembly and reassembly processes.\n\nControl Plan - Battery Engineer:\n* Battery design implemented safety coating layer to mitigate the safety risks on the battery introduced by the replacement or repair of other components.(Battery can be downgraded to generalist-replaceable since the exception requirement is met.)\n\nControl Plan - Compliance/Reverse Logistics:\n* Based upon the tool(s) that are needed by end user for display replaceability, provide details on the category of the tool(s) and what tool(s) need to be sent to the user for display replaceability. Develop user instructions to provide step-by-step instructions.\n* Warnings should be highlighted in the guideline to remind customers of associated risks during display repair.",
                        riskLevel: "Medium Risk"
                    }
                ],
                ketSpecific: [
                    {
                        section: "KET Specific",
                        topic: "Child safety concerns with KET device",
                        description: "KET devices are designed for children, which introduces additional safety considerations.",
                        requirement: "Device must meet all child safety standards and regulations.",
                        controlPlanDetails: "Control Plan:\n* Conduct comprehensive child safety testing\n* Ensure all materials are non-toxic and safe for children\n* Implement additional drop protection features",
                        riskLevel: "High Risk"
                    },
                    {
                        section: "KET Specific",
                        topic: "Educational content safety requirements",
                        description: "Educational content must be age-appropriate and safe for children.",
                        requirement: "All content must be reviewed and approved for the target age group.",
                        controlPlanDetails: "Control Plan:\n* Content review process by education specialists\n* Parental controls for content access\n* Regular content audits and updates",
                        riskLevel: "Medium Risk"
                    }
                ]
            };

            // Define component risks for hearables
            const hearableComponentRisks = {
                waterResistance: [
                    {
                        section: "PD & Structural",
                        topic: "Water ingress through glue joints",
                        description: "Earbuds are rated to IPX4. The earbuds are planning on using the \"double butt\" glue joint, which has not been fully verified. In the case of any leak (on earbuds and case), water may create a short within the electronics.",
                        requirement: "Double butt glue joint must meet IPX4 rating. Case design should pass the reliability Rain Test.",
                        controlPlanDetails: "Control Plan:\n* IPX4 and Rain Test will be conducted for every build. A small allocation of devices will be torn down after testing to check for any ingress paths or corrosion.\n* Double butt glue joint design is currently being verified with mock-up samples that simulate the form factor and weight of the earbuds.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "PD & Structural",
                        topic: "Water ingress through backvent",
                        description: "Back vent ingress was observed in HVT and EVT device, leading to discoloration and severe corrosion on MLB.",
                        requirement: "Option1: Need to have safety coating and thick plane coating (nanocoating) on MLB, B2B/battery connector, and battery exposed terminal tabs. Process control and complete coverage of all the component is a must.\nOption2: Seal the backvent to ensure no water ingress into the earbud internal space (need device redesign).",
                        controlPlanDetails: "Control Plan - MLB:\n* Safety coating for all unprotected single fault circuit components, including upstream circuit such as exposed battery tabs, B2B connector, battery control IC etc.\n* Nano coating to prevent any exposed metal corrosion leading to functional failure.\n\nControl Plan - Battery:\n* Apply water sealing glue on battery tabs.\n\nControl Plan - B2B/battery connector:\n* Need to have robust water sealing to prevent any water ingress or seepage.",
                        riskLevel: "High Risk"
                    },
                    {
                        section: "PD & Structural",
                        topic: "Sleeve design for safety",
                        description: "The sleeve will have an edge and may hurt the user's ears. Concerns include potential skin irritation, abrasion resistance, tearing risk, brittleness, and aging causing crack and leaving debris in ear.",
                        requirement: "Make the sleeve very soft and uniform, no parting lines, two piece sleeves, and peel off issues. Spec of the step and gap for the parting line. Strength of material to be sufficient to prevent tearing. No aging in usage, resistance to disinfection agent, no brittleness or crack in normal usage condition. Sufficient bonding on stabilizer ring.",
                        controlPlanDetails: "Control Plan:\n* Hardness to be confirmed by ID team (40 shore A material).\n* Thickness: option1 0.3mm nominal to 0.4 on edge, option2 0.5mm all around.\n* Material: LSR material not wacker material.\n* Alcohol (IPA), earwax, sebum, sweat test.\n* USW welding process for stabilizer ring.\n* Silicone LSR bio-comp tests.\n* Design to prevent the shift/slide and not cover the mic.",
                        riskLevel: "Medium Risk"
                    }
                ],
                thermalCircuitConcerns: [
                    {
                        section: "EE & EE Integrity",
                        topic: "Earbud soft or hard short on MLB or in-ear flex",
                        description: "Soft short or hard short due to component single fault failure or liquid ingress led to the device overheating when the bud is either off the case or inside the case.",
                        requirement: "The device surface shall not exceed the thermal TS2 safety limit under fault condition.",
                        controlPlanDetails: "Control Plan:\n* Bud battery PCM overcurrent protection is 170mA max.\n* HW thermal cut off circuit on the MLB and in-ear flex which cuts off both the battery power and VCHRG power when temperature exceeds the limits.\n* PIC NTC thermal cut off - 60C+/-3C (Battery, MLB off charger).\n* MLB NTC thermal cut off - 52C +/-3C (MLB).\n* Inear Flex NTC thermal cut off - 55C +/- 3C (Prox sensor).\n* VA sensor will be covered by new CPLD design with fail safe temp sensing circuit.\n* The worst bud detection interval is 1min, if the bud has a short at the CPLD input or ESD diode, the case shall detect it within 1min under the worst case.\n* Add liquid proof coating to the unprotected PCB area (battery pads, battery PIC circuit, thermal cut off single fault circuit including the CPLD circuit).",
                        riskLevel: "High Risk"
                    },
                    {
                        section: "Thermal",
                        topic: "Bud/Case over ergonomic and safety touch temperature limit during normal operation",
                        description: "Device power consumption goes higher than thermal envelope due to additional feature increase, new DSP tuning, etc.",
                        requirement: "The device surface shall not exceed the thermal TS1 safety limit under normal condition.",
                        controlPlanDetails: "Control Plan:\n* Have SW QA checkpoint to maintain the maximum power within thermal budget.\n* Have both short-term and long-term virtual sensor and software policy. Device shuts down in extreme conditions.",
                        riskLevel: "Medium Risk"
                    }
                ],
                battery: [
                    {
                        section: "Battery",
                        topic: "Short on bud MLB causes heating and propagates to battery causing exotherm event",
                        description: "Short on MLB or in SOC causes excessive heating which propagates to battery and causes battery to exotherm.",
                        requirement: "Prevent MLB shortage and board overheating.",
                        controlPlanDetails: "Control Plan:\n* Protection IC with overtemperature is implemented to disconnect battery in case of heating which may slow temperature rise if battery powers the short.\n* Bud thermal cut off circuit also cut off the VCHRG power if temperature exceed limit.\n* Test forced battery exotherm at device level.\n* Complete REL testing (includes abuse conditions) on the battery component level.",
                        riskLevel: "High Risk"
                    },
                    {
                        section: "Battery",
                        topic: "Battery swell due to 4.4V chemistry-HW",
                        description: "Battery swell.",
                        requirement: "Characterize swell risk of 4.4V battery. Success Criteria: Achieve <200dppm swell with cell swell performance and dynamic derating algorithm.",
                        controlPlanDetails: "Control Plan:\n* Develop swell model for charge case.\n* Implement the dynamic stress reduction algorithm.",
                        riskLevel: "Medium Risk"
                    }
                ],
                chargingPort: [
                    {
                        section: "EE & EE Integrity",
                        topic: "USB connector overheat/melting during charging due to pin corrosion",
                        description: "USB pin resistance can increase after corrosion and result in connector overheating or melting during charging.",
                        requirement: "Device shall prevent USB connector overheating due to increase contact resistance.",
                        controlPlanDetails: "Control Plan:\n* USB connector pins are not energized when USB cable is not connected.\n* Implement the charger IC VINDPM. If too much voltage drop across the USB pin, the input current limit is reduced by the charge IC.\n* Need to have plating material covers 4 sides of the pin.\n* The SW thermal policy should detect the connector pin overheating condition and stop case/bud charging.",
                        riskLevel: "Medium Risk"
                    }
                ],
                caseEnclosure: [
                    {
                        section: "Reliability",
                        topic: "Corrosion product skin sensitivity",
                        description: "Metal contacts (pogo pins, pogo pads, etc.) corrode, and the Alkaline corrosion product may cause skin sensitivity/irritation for some users since device is in contact with skin.",
                        requirement: "Metal plating must meet the Amazon metal plating specs and be sufficient to prevent corrosion in standard REL tests. Metal plating that may come into contact with skin for prolonged periods may not use nickel.",
                        controlPlanDetails: "Control Plan:\n* Corrosion tests (salt mist test, sweat corrosion test, sweat charging test) must be performed every build to verify that metal plating is sufficiently good quality.\n* Leach test to check if there's any material leach that would cause skin irritation or not.\n* SEM analysis will be performed after corrosion tests to verify the components present and deem if they are a risk for user sensitivity.\n* PWR and GND pins have been separated as much as possible (7.5mm center to center distance) to prevent likelihood of sweat bridging the two pins and causing electrolytic corrosion.\n* Use corrosion resistant plating materials (such as AP2).\n* Implement liquid detection circuit in the charging case. Two-pin charging will still have liquid/sweat detection implemented.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Reliability",
                        topic: "Stabilizing ring falls off and remains in ear",
                        description: "Stabilizing ring on the earbuds fall off and remains inside user ear, causing discomfort or panic.",
                        requirement: "Stabilizing ring adhesives should not be reactive to chemicals tested by REL, including earwax. Stabilizing ring should not fall off from repeated insertions in and out of the ear (cycling tests).",
                        controlPlanDetails: "Control Plan:\n* Chemical tests planned on the adhesive/glue used for the stabilizing ring to ensure that it does not react with human chemicals or cleaning chemicals.\n* Cycling tests performed on ear mock-ups for every build to confirm there is no impact of friction on the stabilizing ring.\n* Add comfort related testing in BETA specifically to understand skins.",
                        riskLevel: "Medium Risk"
                    }
                ],
                sensors: [
                    {
                        section: "Sensors",
                        topic: "Laser eye safety",
                        description: "VCSEL is used on earbuds, which requires a regulatory notice to the user.",
                        requirement: "Legal disclaimer for laser eye safety on Product Packaging.",
                        controlPlanDetails: "Control Plan:\n* Ensure that legal disclaimer is added on packaging.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Sensors",
                        topic: "Charging case magnet safety",
                        description: "Charging case uses magnets, which may pose risk to users with pacemakers.",
                        requirement: "Once case design is complete, ensure that residual flux at the case external surface does not exceed safety limits.",
                        controlPlanDetails: "Control Plan:\n* Verify once the charging case design is completed that all things meet the applicable compliance standards.",
                        riskLevel: "Medium Risk"
                    }
                ]
            };

            // Define component risks for wearables
            const wearableComponentRisks = {
                battery: [
                    {
                        section: "Battery",
                        topic: "Battery safety structural risks",
                        description: "When battery swells beyond specification while user is wearing a device, or when user drops/impacts/sits on/ steps on the device, the battery may be indented and shorts. Heat associated with the battery failure poses safety risk.",
                        requirement: "Battery indentation rel spec (Agile #05-010467) requires indentation during any event must be less than 0.2mm. In order to avoid the indentation of sharp edge of neighboring components, no sharp edges or corners must be placed around the battery.",
                        controlPlanDetails: "Control Plan:\n1. Have battery testing and verification done by battery and battery integrity team\n2. Gather battery swell and max. thickness data from the vendor\n3. Measure the gap in z-direction around the battery to ensure sufficient clearance for battery swell. Ensure that there is no sharp edges around the battery.",
                        riskLevel: "High Risk"
                    },
                    {
                        section: "Battery",
                        topic: "Battery swelling cracking the case or developing into an exothermic incident",
                        description: "User often keeps battery at high voltages, or forgets device on charger, which can lead to battery swelling cracking the case or developing into an exothermic incident.",
                        requirement: "To meet target swelling of 200 ppm.",
                        controlPlanDetails: "Control Plan:\n* Firmware control of Vmax derating\n* 7 day pulldown should to be implemented to lower the DFMEA control number to 3 or 2\n* Test to simulate: High voltage storage testing",
                        riskLevel: "High Risk"
                    },
                    {
                        section: "Battery",
                        topic: "Pre-Charge Time Lock out",
                        description: "User often forgets to recharge battery for long duration, letting the battery voltage drop below 3.0 V, which can lead to copper dissolution and side reactions that might lead to exothermic reactions.",
                        requirement: "Permanent battery lockout if trouble 0v lockout or precharge timer limits.",
                        controlPlanDetails: "Control Plan:\n* Low voltage lockout measures\n* Firmware keep a non-volatile count of pre-charge time out events and disable charging permanently, if there are 3 time out events\n* Test to simulate: Low voltage storage testing",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Battery",
                        topic: "The protection charge and discharge max. current limit should be safe for battery",
                        description: "High battery current incidents can pose safety risks.",
                        requirement: "Secondary protection at 1.5-2x the max current.",
                        controlPlanDetails: "Control Plan:\n* The Pack overcurrent protection is limited to 1.7C which is tight and good. However, it is a single PIC pack. Therefore the charger IC and the system must provide the secondary protection.\n* Test to simulate: Compliance and Current protection testing",
                        riskLevel: "Medium Risk"
                    }
                ],
                waterResistance: [
                    {
                        section: "Water Resistance",
                        topic: "Water Ingress Risk",
                        description: "Device is rated for water resistance up to 5ATM. In case of any leak, water may create short within electronics inside and could potentially cause device to heat up.",
                        requirement: "Capsule need to be fully sealed at time T0 and post reliability tests that represents various used case scenarios.",
                        controlPlanDetails: "Control Plan:\n1. 100% inspection through Air Leak Testing at FATP line\n2. Testing and proving the design and process via extensive Rel testing and Beta testing",
                        riskLevel: "Medium Risk"
                    }
                ],
                skinContact: [
                    {
                        section: "Skin Contact & Comfort",
                        topic: "Mechanical Skin Irritation Risk",
                        description: "Device's thermal probe protrudes 0.2mm from the bottom surface of the device. This could cause discomfort over time.",
                        requirement: "Discomfort - to be validated via Beta testing.",
                        controlPlanDetails: "Control Plan:\n1. Beta study using EVT capsules.",
                        riskLevel: "Low Risk"
                    },
                    {
                        section: "Skin Contact & Comfort",
                        topic: "Skin Sensitization and Dermal Irritation",
                        description: "Risk assessment of known skin sensitizers and dermal irritants.",
                        requirement: "Levels of skin sensitizers and dermal irritants must be within acceptable limits.",
                        controlPlanDetails: "Control Plan:\n* No actions needed. The EVT samples were within acceptable limits and deemed to be low risk for skin sensitization and dermal irritation.",
                        riskLevel: "Low Risk"
                    },
                    {
                        section: "Skin Contact & Comfort",
                        topic: "Prop 65 and AFIRM RSL Compliance",
                        description: "Risk assessment of chemicals per Prop 65 and AFIRM RSL requirements.",
                        requirement: "Prop 65 chemicals below safe harbor values. AFIRM RSL-listed chemicals below safety limits.",
                        controlPlanDetails: "Control Plan:\n* No actions needed. The EVT samples were within acceptable limits for Prop 65 and AFIRM RSL.",
                        riskLevel: "Low Risk"
                    }
                ],
                chargingSystem: [
                    {
                        section: "Charging System",
                        topic: "Reverse polarity protection in the capsule",
                        description: "Plugging a device in reverse/backward orientation to the charger may damage the internal circuitry of the device.",
                        requirement: "Device shall have circuitry to protect it when plugged in reverse to the charger.",
                        controlPlanDetails: "Control Plan:\n* Reverse polarity protection circuit was validated using a EVT1.2 device. When the charger was plugged in reverse the circuit Reverse polarity protection circuit on the device was implemented in EVT.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Charging System",
                        topic: "Over current or over voltage surge from wall to device during charging",
                        description: "A surge of over current or over voltage from wall to device can result in a single fault with a resistive short at PMIC during charging.",
                        requirement: "To meet TS2 limit of 70C for plastic, and 66C for glass, 61C for metal while on the charger.",
                        controlPlanDetails: "Control Plan:\n* 0402L010SLKR PTC has been implemented in the charger with a maximum current of 500mA within a trip time of 1 second.\n* Surge test of 10 PMICs found all failure modes to draw less than 140mA\n* TVS at the input clamps any over-voltage condition for charger as well as downstream capsule to less than 20V which satisfies the absolute maximum spec of PMIC.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Charging System",
                        topic: "Corrosion at the pogo pins create impedance between Vbus & GND and generate heat",
                        description: "Liquid presents on the device pads cause corrosion. The pogo pins are severely corroded and corrosion creates impedance between Vbus & GND and generate heat.",
                        requirement: "Device should not get corroded during normal usage e.g. being exposed to sweat, salt water, washing solution, placed on charger while wet, etc.",
                        controlPlanDetails: "Control Plan:\n* Liquid detection circuit has been added to charger\n* Design charger to keep an air gap between device and charger while charging to minimize water bridge\n* Surround charger's pogo pins with silicon to minimize water bridge\n* Ensure liquid film cannot bridge dissimilar voltages\n* Ensure liquid cannot pool on possible orientation use case\n* PD change to increase separation between V & GND pin - preferably - GND/FATP on one side and Vbus on another side\n* Test to simulate: Salt water, Sweat Test, Sweat Charging Test",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Charging System",
                        topic: "The pogo pins or device pads are severely corroded that results in loosing coating and cause skin sensitivity",
                        description: "Liquid presents on the device pads cause corrosion. The pogo pins or device pads are severely corroded so that the charger function is lost and loosing coating can cause skin sensitivity.",
                        requirement: "Prevent corrosion. Material selection should be in compliance with ASTM F2999 (Adult Jewelry - Heavy Metals) & device should pass Leach Test at 3rd party.",
                        controlPlanDetails: "Control Plan:\n* Liquid detection circuit has been added to charger\n* Avoid voltage on device pads especially FATP pin during normal operation\n* Ensure plating spec meet REL requirement - required but cannot fix problem alone\n* Charger enclosure and device capsule are plastic and non-conductive\n* Keep GND & Vbus separated\n* Test to simulate: Salt water/Sweat test and Sweat charging test, Leach test at 3rd party",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Charging System",
                        topic: "Short on charger pins",
                        description: "Short on energized charger pin. If no protection in place, device's charger exposed pogo pins are capable of providing >15W of power during single fault or short condition on charging contacts. It can potentially generate heat when foreign contaminates caused a power to ground short at connector interfaces.",
                        requirement: "Reduce the risk by controlling available power to lower level during the fault.",
                        controlPlanDetails: "Control Plan:\n* Limit available power (eFuse or PTC) on exposed pins\n* ID to ensure this will not happen by design\n* Using a smart charger to detect faulty connection\n* Test to simulate: short and resistive short test on charger pins",
                        riskLevel: "Medium Risk"
                    }
                ],
                electrical: [
                    {
                        section: "Electrical",
                        topic: "Electrical single fault failure while device on wrist",
                        description: "Single fault leading to thermal runaway when worn on the wrist, on internal components such as SoC/BTC/Haptic Driver/Display Driver.",
                        requirement: "To meet TS2 limit of 58C on capsule.",
                        controlPlanDetails: "Control Plan:\n* For single fault cases where MCU is still functional and firmware is responsive, the firmware will sample the board temperature sensor every 30s. In case of an over temperature event, firmware shall put the device into thermal mode.\n* For single fault cases where MCU is not functional and firmware is inactive:\n  * Current battery spec sets OTP at 50C +/- 3C and OCP max at 169mA to mitigate the power dissipation inside the capsule.\n  * Validated surface temperature within TS2 of 58C for worst single fault scenarios (battery OCP trips for fault power of 642mW at HRM AFE)",
                        riskLevel: "High Risk"
                    },
                    {
                        section: "Electrical",
                        topic: "Electrical single fault failure while device on the charger",
                        description: "Single fault leading to thermal runaway during charging, on internal components such as SoC/BTC/Haptic Driver/Display Driver when on the charger.",
                        requirement: "To meet TS2 limit of 70C (less than 1min) on plastic, and 66C on glass, 61C for metal.",
                        controlPlanDetails: "Control Plan:\n* For single fault cases where MCU is functional and firmware is responsive, firmware will put the device in Safe Mode, disabling charging and reducing VIN_ILIM to 98mA. Firmware will also configure the PMIC to disconnect battery from the ASYS power path.\n* For single fault cases where MCU is not functional and firmware is not responsive:\n  * PMIC watchdog will expire in 32s and device will enter Safe Mode automatically. This disables charging and reduces VIN_ILIM to 98mA.\n  * LDO1/LDO2/SW1/SW2 enters the mode 0 setting (the default factory setting for the initial power up)\n  * Battery pack has an internal thermal monitoring circuit which will cut power to the device if the battery pack temperature exceeds 50C +/- 3C.",
                        riskLevel: "High Risk"
                    }
                ],
                thermal: [
                    {
                        section: "Thermal",
                        topic: "Charging the battery without battery pack thermal monitoring and enforcing JEITA profile poses a safety risk",
                        description: "Charging without proper thermal monitoring can lead to safety risks.",
                        requirement: "Battery shall be charged only when the firmware is active and battery temperature monitoring is enabled in the PMIC.",
                        controlPlanDetails: "Control Plan:\n* Device boots up in Safe Mode (Mode 0) by default and charging is disabled. After device boot up is complete, firmware enables battery thermal monitoring and enables charging.\n* If a situation arises where firmware is non responsive, PMIC watchdog will expire in 32 seconds, switching the device back to Safe Mode (Mode 0), disabling charging.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Thermal",
                        topic: "SW thermal management policy for over temperature case and temperature sensor non-functional",
                        description: "If either of the temperature sensors fails, an error handling mechanism will be triggered by SW thermal policy.",
                        requirement: "To meet TS2 limit of 58C on capsule when worn on wrist; 70C for plastic, 66C for glass and 61C for metal while charging.",
                        controlPlanDetails: "Control Plan:\n* SW thermal policy polls the two onboard temperature sensors every 30s, if either of the sensors fail for 3 consecutive times, device will reboot\n* Thermal policy has been enabled for Beta users. Thermal policy entry and exit criteria validated in EVT.",
                        riskLevel: "Medium Risk"
                    }
                ],
                complianceEnvironmentalPolicies: [
                    {
                        section: "Compliance",
                        topic: "Safety Compliance Certification",
                        description: "Compliance to the applicable safety standard UL/CSA/IEC 60950 Ed.2 + Am.1 + Am.2 and UL/CSA/IEC 62368-1, Ed.2 with National Deviations covering the following list of countries - US, CA, EU(DE/UK), JP.",
                        requirement: "Current design shall comply to a certification agency compliance assessment, in accordance to the applicable standards listed above.",
                        controlPlanDetails: "Control Plan:\n1. HVT Phase - Construction Review with limited testing to standards listed above.\n   * Deliverable - Construction review letter report with test data report\n2. EVT Phase - Construction review + complete testing\n   * Deliverable - Test reports, CB Certificate",
                        riskLevel: "Medium Risk"
                    }
                ]
            };

            // Define component risks for E-Readers
            const ereaderComponentRisks = {
                battery: [
                    {
                        section: "Battery",
                        topic: "Temperature gradient across battery exceeds vendor recommendation",
                        description: "A temperature gradient across the cell can cause accelerated battery swell and battery degradation.",
                        requirement: "Temperature gradient (Tmax-Tmin) across the single cell must not exceed 5°C.",
                        controlPlanDetails: "* Battery PCM design has an NTC to provide battery temperature feedback to charger IC. The charger will regulate the total charge current and top off charge voltage based on the JEITA profile.\n* System level validation tests involve thermal profile tests to verify requirements at HVT and EVT.\n* Changes in charge currents can be implemented using a FW solution to reduce battery swell or degradation and ensure thermal management without increasing Z thickness.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Battery",
                        topic: "Battery swell due to 4.48V chemistry",
                        description: "Battery swelling is generated by gas generation due to the cell being at high voltages. The longer it is held at these higher voltages, more gas will be generated and the battery will swell quicker.",
                        requirement: "Implement pre-existing dynamic stress reduction algorithm\nSuccess Criteria:\n* Using the stress reduction algorithm, a derating strategy must be generated meeting the following BRD requirements:\n* Battery gaseous swelling must be contained to 200 dppm in 5 years\n* No derating of battery for TP95 of population in 3 years of use.\n* No derating for TP95 of population over 5 years that reflects more than 10% loss of capacity.",
                        controlPlanDetails: "* Characterize [insert device name here] DOE and POR batteries for swelling using accelerated swell testing methodology\n* Develop a swell model for both to understand the swell behavior at different temperature and voltage conditions\n* Develop a derating strategy that meets BRD requirements and implement the derating strategy for [insert device name here] aboard the dynamic stress reduction algorithm\n* This will likely take place during DVT due to long duration of testing\n* Validate [insert device name here]'s dynamic stress reduction algorithm with the firmware integrity team",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Battery",
                        topic: "USB connector intermittently connects and re-connects causing charging to start and stop constantly",
                        description: "USB connector intermittently connects and re-connects causing charging to start and stop constantly. This can lead to thermal runaway and accelerated battery swell and degradation.",
                        requirement: "Only recharge the battery when battery is significantly discharged or USB is disconnected for long period of time.",
                        controlPlanDetails: "* Implement learnings from Trona and onboard 7 day pull down.\n* Onboard Fast charge timer FW feature with debounce setting of 60 seconds to avoid recharging due to short USB disconnect/reconnect events.\n* Scenario not observed in [insert device name here] or other previous generation e-readers. Less likely of intermittent reconnect due to less power as compared to tablets.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Battery",
                        topic: "Battery is overcharged (HW)",
                        description: "The battery can become overcharged if: (1) The taper current cutoff too low; (2) The PCM fails to protect in single fault scenario; (3) The charge voltage setting too high.",
                        requirement: "Taper current must not go lower than minimum specified in the cell spec. Charge voltage must not go above the absolute maximum voltage allowed by the cell spec. PCM fails to protect in single fault scenario—does not apply as that is a double fault scenario.",
                        controlPlanDetails: "* Taper current setting is aligned with the battery specs with tolerances. No top off charging is allowed to prevent over charge conditions under no SW control scenarios.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Battery",
                        topic: "Battery is overcharged (FW)",
                        description: "Battery is overcharged.",
                        requirement: "Include battery safety and stress reduction daemon software to monitor battery state and de-rate battery top of charge on battery stress detection, disable charging on battery fault detection. See FW Integrity's battery SW design spec, Agile PN 05-043290.",
                        controlPlanDetails: "* Battery SW control on all registers will be validated in HVT and EVT. If SW is not available by HVT, additional validation will be done at DVT.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Battery",
                        topic: "Battery is constantly recharged leading possible exotherm events",
                        description: "If the recharge threshold is set too low, it can lead to constant recharging of the battery which can lead to exotherm events in worst-case scenarios.",
                        requirement: "The battery must be allowed to relax a minimum of 100mV from top of charge in order for subsequent recharging.",
                        controlPlanDetails: "* Onboard Topoff hysteresis FW feature with hysteresis > 100mV.\n* Battery system level validation will be done in HVT and EVT. If SW is not available by HVT, additional validation will be done at DVT.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Battery",
                        topic: "Battery jelly-roll shift post device drop/tumble",
                        description: "The jelly-roll inside battery should not have huge shift during drop/tumble.",
                        requirement: "The electrolyte amount should be balanced with the overall drop performance.",
                        controlPlanDetails: "* The adhesive used to fix the jelly-roll is hot melt glue instead of single side glue.\n* The separator used is high-adhesive and bottom tape is added to prevent the free electrolyte from flushing the separator and cause separator shift.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Battery",
                        topic: "Battery delamination from the PSA during extended drop + tumble testing",
                        description: "Battery delamination from the PSA is important to prevent subsequent mechanical damage to the battery.",
                        requirement: "The battery must not delaminate during extended drop + tumble testing",
                        controlPlanDetails: "* Quality data to be reviewed at each XVT-stage:\n  * 180deg Peel Adhesion on PSA tape data must be reviewed with the MTS/AME/SQM engineer\n  * 180deg Peel Adhesion on Release Liner must be reviewed with the MTS/AME/SQM engineer\n  * Release force for liner aging data must be reviewed with the MTS/AME/SQM engineer\n  * Loss of Adhesion data must be reviewed with the MTS/AME/SQM engineer\n  * Silicon oil amount with XRF data must be reviewed with the MTS/AME/SQM engineer\n  * Battery surface energy data needs to be reviewed with the MTS/AME/SQM engineer\n* Reliability testing to be conducted at each XVT-stage:\n  * System extended drop + tumble testing",
                        riskLevel: "Medium Risk"
                    }
                ],
                physicalDesign: [
                    {
                        section: "PD/Structural",
                        topic: "Rear cover lip cracking for 5052H32, post corner drop",
                        description: "Rear cover lip cracking for 5052H32, post corner drop, with a potential laceration risk if the crack propagates deeper.",
                        requirement: "Break strain limit of rear cover material needs to be high enough to prevent deep crack propagation, post corner drop. Based on simulations the strain limits for 6061T6 show a lower risk.",
                        controlPlanDetails: "* DOE upsetting trials with alternate rear cover materials with higher break strain limits (5H59H32 and 6061T6)\n* If there are process limitations to upsetting for 5H59H32 and 6061T6, alternate options are as below:\n  * CNC metal bucket using 6061T6 (cost adder)\n  * Full CNC rear cover using 6061T6 (cost adder)",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "PD/Structural",
                        topic: "Battery shifts after tumble/drop",
                        description: "Battery de-laminates or shifts after tumble/drop.",
                        requirement: "No significant battery deformation or shift after tumble/drop.",
                        controlPlanDetails: "* Optimize PSA material, XY footprint and assembly process to prevent significant battery shift after tumble/drop.\n* Add 05-046054 on PD drawing for PSA liner spec per recent lessons learned on Sangria to maintain silicone free PSA surface\n* Inspection of battery before and after reliability tests in HVT to validate.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "PD/Structural",
                        topic: "Internal damage to battery due to excessive lamination pressure during assembly",
                        description: "Battery separator or internal structure may be damaged by excessive lamination pressure during PSA activation.",
                        requirement: "PSA needs to meet minimum psi for activation without exceeding maximum psi defined by battery supplier.",
                        controlPlanDetails: "* Fixture pressure levels for battery assembly to be controlled with SOP and confirmed and will be validated by reliability tests in HVT.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "PD/Structural",
                        topic: "Battery damage due to core-outs (punch burrs) in mid-frame",
                        description: "Battery pouch may be damaged when laminated over imperfect core-outs (punch burrs) in the mid-frame.",
                        requirement: "No cosmetic and functional damage to the battery after assembly or mechanical reliability tests.",
                        controlPlanDetails: "* Midframe DFM and 2D calls out burrs on opposite direction of the battery side to prevent rough imperfections directly under the battery surface.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "PD/Structural",
                        topic: "Snaps (if present) breaking in tumble/drop, risking battery damage",
                        description: "Any broken snap may travel onto battery and cause battery damage.",
                        requirement: "Snaps (if present) should not break during mechanical tests.",
                        controlPlanDetails: "* [insert device name here] does not use snaps and therefore will not have this associated risk.",
                        riskLevel: "Low Risk"
                    },
                    {
                        section: "PD/Structural",
                        topic: "Sharp edges and corners could cause injuries",
                        description: "Any sharp edges and very small corner radius can cause injury by skin contact.",
                        requirement: "There are generic design guidelines for corner radius [C] and top/bottom edge radius [E]: if corner radius [C] is less than 2.5mm, the top/bottom edge radius [E] should be at least 0.3mm; if corner radius [C] is more than 2.5mm, the top/bottom edge radius [E] should be at least 0.1mm. Minimum radius for corner radius should be at least 0.3mm.",
                        controlPlanDetails: "* The device corner radius is >2.5mm and top/bottom edge radii are >0.2mm (requirement >0.1mm).",
                        riskLevel: "Low Risk"
                    }
                ],
                chargingPort: [
                    {
                        section: "EE",
                        topic: "Liquid ingress into USB port during charging, causing burnt connector",
                        description: "Reduced resistance between power pins and other pins leading to burnt connector.",
                        requirement: "Add liquid detection. Reduce the input current limit if liquid is detected with VUSB. Lock down the screen when liquid is detected with VUSB.",
                        controlPlanDetails: "* Design has USB moisture ingress detection IC.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "EE",
                        topic: "Liquid ingress into device, leading to unprotected power dissipation",
                        description: "Liquid bridging VBUS to GND test points and cause unprotected power dissipation.",
                        requirement: "Separate the power and ground test point by 6mm to 10mm.(VBUS to ground, VBATT to ground)",
                        controlPlanDetails: "* Implement liquid ingress barrier in USB connector port.\n* Battery has PCM in case of short across VBAT and GND\n* USB moisture ingress detection IC has built-in protection for VBUS and GND",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "EE",
                        topic: "USB surge voltage damages charger IC",
                        description: "Charger IC overheats.",
                        requirement: "Charger IC is rated for 30V VBUS to GND and 26V VBUS to output. Collect historical field data from previous gen which same family charger IC is used.",
                        controlPlanDetails: "* Rel testing for P2 FATP devices.\n* Current design is a follow up from [insert device name here] design hence same design and testing methodology has been used to make sure this is low risk.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "EE",
                        topic: "SBU pin Liquid Detection over-voltage risk",
                        description: "The Max20342 sources current on the SBU pin for liquid detection. This current source pull-up voltage is sourced from VCCINT, an IC internal rail powered from either VB_REG (3.75V) when VBUS is present or Vsys when VBUS is not present. As a result, the SBU voltage when the current source is enabled can be as high as VSYS which is 4.45V. This high voltage exceeds the SBU pin USB safe state voltage requirement (<=1.5V) per the USB-C spec and the USB PD spec. This can be a safety issue when the device is connected to (1) Unpowered DFP (unpowered laptop USB-C port - device USB-C port); (2) A UFP (e.g. Tablet); as it can damage the connected device when [insert device name here] cannot detect connected device and continue to pulse on SBU pins for liquid detection.",
                        requirement: "[insert device name here] should not cause damage to any connected device by violating USB-C spec.",
                        controlPlanDetails: "* Refer to [insert device name here] Max20342 SBU pin Liquid Detection Over-voltage risk.\n* Add 732Kohm pull-down resistors on SBU pins through low side FETs and select the source current for liquid detection pulsing such that SBU pin voltage is max 1.5V.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "EE",
                        topic: "Foreign contaminants create a power to ground short at connector interfaces",
                        description: "Multiple devices have experienced heat when foreign contaminates caused a power to ground short at connector interfaces. Power to ground shorts have been caused by contaminants such as liquid, sports drinks, conductive salts, salt water, and dust. These issues have also occurred due to drop, bent pin, and manufacturing issues. The issues have occurred on ZIF screen connectors, board-to-board connectors and board to flex connectors.",
                        requirement: "Prevent power to ground shorts at connector interfaces by separating the pins to the extent possible, the further apart the pins are, the less likely something can span the gap.",
                        controlPlanDetails: "* Add extra pins between power and ground pins during pin assignment.\n* Add extra pins between high voltage and low voltage pins during pin assignment.\n* Implement liquid ingress barrier in USB connector port.",
                        riskLevel: "Medium Risk"
                    }
                ],
                thermalCircuitConcerns: [
                    {
                        section: "Thermal",
                        topic: "Surface temperature exceeding ergo/safety limit",
                        description: "(1) Unit exposed to excessive heat during charging like direct sunlight. (2) Unit covered with blanket or other material preventing air circulation.",
                        requirement: "Incorporate thermal policy to shutdown the device when virtual sensor temperature/component temperature exceeds threshold.",
                        controlPlanDetails: "* Implement thermal policy for managing surface temperature on [insert device name here] and mitigate risks.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Thermal",
                        topic: "Increased device power consumption and heating from electrical shorts",
                        description: "A short, either from a failing component or from contamination, can lead to device power consumption and heating. This could be an internal short in a component, bridging due to solder creep/tin whisker, wear on a cable assembly, impacts from vibration/drop/tumble, or a conductive contaminant (e.g. gatorade) inside a device.",
                        requirement: "If a short occurs on a board, the power rails should have limits that correspond to what the components and peripherals need and should not source unlimited current to a fault.",
                        controlPlanDetails: "* The current will be limited by the OCP in place.\n* Implementation of Single Fault Protection Circuit (SFPC) to shut off power if abnormal temperatures are detected to prevent the device from reaching harmful temperatures.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Thermal",
                        topic: "In case of short or other hard faults with SoC, it may run hot and heat up the system",
                        description: "If there is a hard fault (SOC cannot restart by watchdog) then the SOC can run warm and not shut down. Even if the SOC is not hung a fault on certain rails (e.g. main system always-on voltage) may be outside the control of the SOC. This could lead to thermal policy not being correctly enforced in a failure state.",
                        requirement: "Thermal policy to ensure that device overheating is prevented.",
                        controlPlanDetails: "* Implementation of Single Fault Protection Circuit (SFPC) to shut off power if abnormal temperatures are detected to prevent the device from reaching harmful temperatures.",
                        riskLevel: "Medium Risk"
                    }
                ],
                complianceEnvironmentalPolicies: [
                    {
                        section: "HW Compliance",
                        topic: "Product Safety Compliance & Certification Requirements",
                        description: "Compliance to the applicable safety standard IEC60950 Ed.2 + Am.1 + Am.2, IEC62368-1 Ed. 2, and IEC62368-1 Ed. 3 IEC62668-1 Ed. 4 with National Deviations covering all the POR regions.",
                        requirement: "Design shall comply to a certification agency compliance assessment, in accordance to the applicable standards listed above.",
                        controlPlanDetails: "* HVT Phase - Construction Review + full safety pre-compliance testing to standards listed above.\n  * Deliverable – Construction review letter, completed test data sheets.\n* EVT Phase – Construction Review (delta vs HVT) + full safety compliance testing to standards listed above.\n  * Deliverable – CB Test Reports & Certificates per noted standards above.\n* DVT Phase - Construction Review (delta vs EVT) + regression safety compliance testing to standards listed above.\n  * Deliverable - CB Test Reports & Certifications per noted standards above",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Environmental Compliance",
                        topic: "Environmental Compliance Requirements",
                        description: "All the materials for the device must meet the EC requirements by complying with the respective regional, national or local environmental laws and regulations where they are placed on the market for sale.",
                        requirement: "The details for these requirements are described in the Amazon Devices and Services Restricted and Reportable Substance List (Amazon RSL), PN: 05-003018 and Amazon Supplier's Declaration of Compliance (SDoC), PN: 05- 030181.",
                        controlPlanDetails: "* Ask CM to complete the compliance documents collection before PVT RR. EC team will provide the risk level for the DVTRR and PVTRR. The compliance documents may include:\n  * Completed and signed product-level Amazon Supplier Declaration of Compliance (SDoC) form 05-030181\n  * Full Material Disclosures (\"FMD\") should be provided for all external, user accessible parts from each part supplier, if multiple sourced, for PROP 65 (California substance exposure regulation) compliance verification. Amazon recommends the use of Amazon FMD template 05-038004.\n  * Halogen Test Report for all external, user accessible parts from each part supplier, if multiple sourced.\n  * Product-level Bill of Materials (\"BOM\") 05-034983\n  * Other 3rd Party Lab test reports base on the BOM o Material Safety Datasheets (MSDS), if applicable.",
                        riskLevel: "Medium Risk"
                    }
                ]
            };

            // Define EFD component risks
            const efdComponentRisks = {
                rockerSwitch: [
                    {
                        section: "Product Design Structural",
                        topic: "Liquid ingression into rocker switch area",
                        description: "Liquid may enter through the rocker switch area, leading to dysfunctional mute button or privacy circuit failure.",
                        requirement: "Device should maintain functionality after exposure to normal amounts of liquid that may contact the rocker switch.",
                        controlPlanDetails: "Control Plan - PD:\n* Adding drain feature to guide the liquid draining to the bottom of the rocker switch",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Electrical",
                        topic: "ESD risk through rocker switch",
                        description: "Electrostatic discharge may occur through the rocker switch, potentially affecting the mute circuit and mute LED (privacy circuit).",
                        requirement: "Device must maintain functionality after ESD events through the rocker switch.",
                        controlPlanDetails: "Control Plan - ESD:\n* Cable harness is required.\n* Pending ESD assessment (OK2FAB item)",
                        riskLevel: "Medium Risk"
                    },
                    {
                       section: "Product Design Structural",
                        topic: "Volume control icon edge and switch plate edge",
                        description: "Sharp edges on volume control icon or switch plate may cause discomfort or minor injury to users.",
                        requirement: "All edges must meet safety requirements for edge radius.",
                        controlPlanDetails: "Control Plan - PD:\n* Pending dimension info and design snapshot",
                        riskLevel: "Low Risk"
                    }
                ],
                muteButton: [
                    {
                        section: "Product Design Structural",
                        topic: "Liquid ingression into mute button area",
                        description: "Liquid may enter through the mute button area, leading to dysfunctional mute button or privacy circuit failure.",
                        requirement: "Device should maintain functionality after exposure to normal amounts of liquid that may contact the mute button.",
                        controlPlanDetails: "Control Plan - PD:\n* Pending decision of using Piezo DOE to seal the gap between",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Electrical",
                        topic: "ESD risk through mute button",
                        description: "Electrostatic discharge may occur through the mute button, potentially affecting the mute circuit and mute LED (privacy circuit).",
                        requirement: "Device must maintain functionality after ESD events through the mute button.",
                        controlPlanDetails: "Control Plan - ESD:\n* Cable harness is required.\n* Pending ESD assessment (OK2FAB item)",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Product Design Structural",
                        topic: "Mute LED indicator and privacy control",
                        description: "Failure of mute LED indicator may lead to privacy concerns if users are unaware of device status.",
                        requirement: "Mute LED indicator must clearly indicate privacy status and be reliable.",
                        controlPlanDetails: "",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Product Design Structural",
                        topic: "Mute icon edge radius",
                        description: "Sharp edges on mute icon may cause discomfort or minor injury to users.",
                        requirement: "All edges must meet safety requirements for edge radius.",
                        controlPlanDetails: "Control Plan - PD:\n* Pending dimension info and design snapshot",
                        riskLevel: "Low Risk"
                    },
                    {
                        section: "Reliability",
                        topic: "Mute privacy deficiency post drop",
                        description: "Device drop may cause mute button or privacy circuit to fail, leading to privacy concerns.",
                        requirement: "Mute functionality should remain operational after normal drop events.",
                        controlPlanDetails: "Control Plan - PD:\n* Drop analysis and EVT REL drop test did not show mic privacy circuit damage so far - Medium to low risk.",
                        riskLevel: "Medium Risk"
                    }
                ],
                lubricant: [
                    {
                        section: "Materials",
                        topic: "Lubricant material leakout",
                        description: "Lubricant materials used in the device may leak out, causing exposure to users or factory workers.",
                        requirement: "Lubricant materials must be contained and not leak during normal use or manufacturing.",
                        controlPlanDetails: "Control Plan - PD:\n* Pending lubricant selection",
                        riskLevel: "Medium Risk"
                    }
                ],
                moldedParts: [
                    {
                        section: "Product Design Structural",
                        topic: "Sharp edge/corner on molded components",
                        description: "Molded components may have sharp edges or corners that could cause discomfort or injury to users.",
                        requirement: "All molded components must meet safety requirements for edge and corner radius.",
                        controlPlanDetails: "",
                        riskLevel: "Medium Risk"
                    }
                ],
                deviceIngress: [
                    {
                        section: "Product Design Structural",
                        topic: "Liquid ingress into the device through speaker port",
                        description: "Liquid may enter the device through the speaker port or other entrances, potentially causing electrical shorts or other failures.",
                        requirement: "Device should be designed to minimize liquid ingress through speaker ports and other openings.",
                        controlPlanDetails: "",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Product Design Structural",
                        topic: "Spill risk on the power adapter area",
                        description: "Liquid spills near the power adapter connection may cause electrical shorts or other failures.",
                        requirement: "Power adapter connection should be designed to minimize risk from liquid spills.",
                        controlPlanDetails: "",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Product Design Structural",
                        topic: "Liquid ingress through I/O board and bottom of the housing",
                        description: "Liquid may pool at the bottom of the device and enter through the I/O board or housing seams.",
                        requirement: "Device should be designed to prevent liquid pooling and ingress through the bottom of the housing.",
                        controlPlanDetails: "Control Plan - PD:\n* Woofer area to be sealed? Samantha Devapiriam\n* Check any path allowing water ingress from tail cap area Samantha Devapiriam",
                        riskLevel: "Medium Risk"
                    }
                ],
                display: [
                    {
                        section: "Display",
                        topic: "Liquid crystal material leakage after LCD screen cracking",
                        description: "If the LCD screen cracks, liquid crystal material may leak out, potentially causing exposure to users.",
                        requirement: "LCD design should minimize risk of liquid crystal material leakage if screen is cracked.",
                        controlPlanDetails: "",
                        riskLevel: "Low Risk"
                    },
                    {
                        section: "Product Design Structural",
                        topic: "Cover Glass detached by gravity",
                        description: "Cover glass may detach from the device due to gravity or other forces, potentially causing injury.",
                        requirement: "Cover glass must be securely attached to prevent detachment during normal use.",
                        controlPlanDetails: "",
                        riskLevel: "Medium Risk"
                    }
                ],
                usbPort: [
                    {
                        section: "Electrical",
                        topic: "USB-C output port Overcurrent Protection",
                        description: "Overcurrent conditions at the USB-C port may cause overheating or other failures.",
                        requirement: "USB-C port must have appropriate overcurrent protection.",
                        controlPlanDetails: "Control Plan - HW Compliance:\n* HVT Phase - Construction Review + safety pre-compliance testing to standards listed in section 11.1.\n* Deliverable – Construction review letter, completed test data sheets.\n* EVT Phase – Construction Review (delta vs HVT) + safety compliance testing to standards listed in section 11.1.\n* Deliverable – CB Test Reports & Certificates per noted standards in section 11.1.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Electrical",
                        topic: "USB-A input circuit protection",
                        description: "USB-A input may be subject to overvoltage or overcurrent conditions.",
                        requirement: "USB-A input must have appropriate circuit protection.",
                        controlPlanDetails: "Control Plan - EE:\n* All the components on USB-A input circuit up to and including e-fuse shall be rated to withstand steady state 12V with appropriate derating.",
                        riskLevel: "Medium Risk"
                    }
                ],
                powerAdapter: [
                    {
                        section: "Product Design",
                        topic: "Capacitors venting on the housing in power adapters",
                        description: "Capacitors in power adapters may vent, potentially causing damage to the housing or exposure to users.",
                        requirement: "In power adapters all venting capacitor clearance height should be checked and there should be a minimum clearance to the top surface of Max Vent Height + 2mm.",
                        controlPlanDetails: "Control Plan:\n* AP23 is launched/MP so this should be resolved",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Reliability",
                        topic: "Power adapter single fault failure",
                        description: "Single fault failures in the power adapter may cause overheating or other safety issues.",
                        requirement: "The preventative action is to use a box type fuse that is specified to maintain its mechanical integrity when clearing and had a high I^2t rating. In addition, risk of AC conductive paths can be limited by adding insulation material and increasing creepage and clearance specs. L-N & L-L creepage 4 mm minimum for unprotected AC mains conductors (on and prior to the fuse). L-N & L-L Clearance 2.3 mm minimum for unprotected AC mains conductors (on and prior to the fuse).",
                        controlPlanDetails: "Control Plan:\n* AP27 uses a box type fuse to clear single fault failure, minimum distance for L-N & L-L creepage is 4.02mm and minimum distance for L-N & L-L Clearance is 2.91mm, both of them meet Amazon's safety requirement.\n* AP27 will conduct single fault test in AcBel Lab and 3rd-party Lab(TUV and UL).",
                        riskLevel: "Medium Risk"
                    }
                ],
                magneticMount: [
                    {
                        section: "Product Design",
                        topic: "Magnetic mount pinch risk",
                        description: "Magnetic mounts may create pinch points that could cause minor injury to users.",
                        requirement: "If there is a pinch event, the magnetic force shouldn't be strong enough to damage skin or cause notable pain to the user.",
                        controlPlanDetails: "Control Plan:\n* Beta study to evaluate any pinch risk",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Reliability",
                        topic: "Device falls-off during normal vehicular operations",
                        description: "Device may detach from magnetic mount during normal vehicle operations, potentially causing driver distraction.",
                        requirement: "Magnetic/adhesive strength should be strong enough to survive common vehicular vibration and any shock scenarios such as pothole, acceleration/deceleration.",
                        controlPlanDetails: "Control Plan - PD:\n* Q20 to hold the device weight. Heatstake POR Q20 process as Piezo",
                        riskLevel: "High Risk"
                    },
                    {
                        section: "Reliability",
                        topic: "Adhesive mount leaving a permanent residue or damaging mounting surfaces",
                        description: "Adhesive mounts may leave residue or damage surfaces when removed.",
                        requirement: "As per Greenwood reliability tenets, adhesive mount solution should be strong enough to prevent any device fall-off. However, the adhesive should not leave any permanent residue on the mounting surfaces. If the adhesive leaves a residue even after using typically available stain releasing chemicals such as alcohol pads, goo-gone etc,, then this is treated as a fail.",
                        controlPlanDetails: "",
                        riskLevel: "High Risk"
                    }
                ],
                ledIndicators: [
                    {
                        section: "Optics",
                        topic: "LED brightness may cause driving safety risk",
                        description: "Excessively bright LEDs may cause distraction or temporary vision impairment while driving.",
                        requirement: "In addition to the ALS on the Mic Module for automatic brightness adjustment, it is Recommended to allow LED brightness controls to customer so they can adjust based on their tolerance levels during driving experience.",
                        controlPlanDetails: "Control Plan:\n* Greenwood supports the ability to turn off the LED from the APP setting screens.\n* User feedback from Beta testing",
                        riskLevel: "Medium Risk"
                    }
                ],
                speaker: [
                    {
                        section: "HW Compliance",
                        topic: "Ultrasound Safety Compliance & Certification Requirements",
                        description: "Ultrasonic emissions from speakers must comply with safety standards.",
                        requirement: "Design shall comply with Amazon's concluded limit of 100 dB, and frequency >25 kHz.",
                        controlPlanDetails: "Control Plan:\n* Please follow ultrasound test plan",
                        riskLevel: "Medium Risk"
                    }
                ],
                battery: [
                    {
                        section: "Electrical",
                        topic: "Over-voltage and over-current related failures",
                        description: "Battery may be subject to over-voltage or over-current conditions, potentially causing overheating or other failures.",
                        requirement: "Efuse's UVLO and OCP settings done properly to protect components from over-voltage and over current faults.",
                        controlPlanDetails: "Control Plan:\n* Efuse threshold for over-voltage is around 7.8V\n* Efuse OCP is 2A.\n* These limits will be tested in HVT. Thresholds adjustments are done via BOM change.",
                        riskLevel: "High Risk"
                    }
                ],
                thermalManagement: [
                    {
                        section: "Thermal",
                        topic: "Device surface temperature exceeds safety limit",
                        description: "Device surface temperature may exceed safety limits during operation, potentially causing discomfort or injury to users.",
                        requirement: "Under normal use conditions, the device surface shall not exceed the safety limits. Thermal policy will ensure that when temperature measurement via the sensor is exceeding a certain value, the device will go into stand-by mode to allow the temperatures to drop before resuming normal operation.",
                        controlPlanDetails: "Control Plan:\n* Simulations show that during normal operation, surface temperature is within the safety limits, even when device is utilizing maximum load.\n* Thermal policy will ensure that even during hot start, surface temperatures stay within safety limits (TS1), and the device goes to stand-by mode if necessary to maintain the safe limit.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Thermal",
                        topic: "Increased device power consumption and heating from electrical shorts",
                        description: "Electrical shorts may cause increased power consumption and heating, potentially exceeding safety limits.",
                        requirement: "If a short occurs on a board make sure it doesn't have a blank check to use power. That is, the power rails should have limits that correspond to what the components and peripherals need and should not source unlimited current to a fault.",
                        controlPlanDetails: "Control Plan:\n* Use power supply components with a current limit, use current limit settings (e.g. resistors) that account for expected loads.\n* Monitor external devices (USB ports, USB-C charging, etc.) for current consumption.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Thermal",
                        topic: "In case of short or other hard faults with SoC, it may run hot and heat up the system",
                        description: "SoC faults may cause excessive heating, potentially exceeding safety limits.",
                        requirement: "Thermal policy to ensure that device overheating is prevented.",
                        controlPlanDetails: "Control Plan:\n* Use thermal policy enforcement mechanisms that do not rely on the SOC. Place local thermal sensors that do not rely on SOC function\n* Shut off the device as part of the policy flow (enable pins disabled by default pull up/down and SOC must actively drive lines to enable peripherals).",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Thermal",
                        topic: "Component Failure due to water intrusion or user plugin higher than rated PSU",
                        description: "Water intrusion or use of higher than rated power supply may cause component failures and excessive heating.",
                        requirement: "Thermal policy to ensure that device overheating is prevented. [EE/PD/Thermal to help come up with mitigations]",
                        controlPlanDetails: "Control Plan:\n* Implement OCP/OVP to shutdown power in case of component short on PCBA",
                        riskLevel: "Medium Risk"
                    }
                ],
                compliance: [
                    {
                        section: "HW Compliance",
                        topic: "Mandatory and voluntary product safety standards",
                        description: "Device must comply with various mandatory and voluntary safety standards.",
                        requirement: "The following mandatory and voluntary standards have been identified: IEC/EN 62368 - 1 \"Audio/video, information and communication technology equipment - Part 1: Safety requirements\" 2nd and 3rd edition. (Mandatory in EU), UL 62368 - 1 and CAN/CSA 22/2 No.62368 - 1 \"Audio/video, information and communication technology equipment - Part 1: Safety requirements\" 2nd and 3rd edition (Voluntary in US and CA), IEC 60950 - 1 (Mandatory for IN, Voluntary in other markets)",
                        controlPlanDetails: "Control Plan:\n* Perform pre-compliance testing and evaluation of devices at HVT. The EVT build is considered the certification build.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "HW Compliance & PD",
                        topic: "Fire Enclosure risks",
                        description: "Device enclosure must provide appropriate fire protection.",
                        requirement: "All unique combinations must pass the tests of the HB flammability rating according to the UL 94 standard. Safety compliance certification would not be issued if we cannot meet the requirement.",
                        controlPlanDetails: "Control Plan:\n* Ensure the PD team is aware of this requirement and have all unique combinations provided to safety compliance for testing. Unique combinations of materials must be locked down by EVT.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "HW Compliance",
                        topic: "Children's (KEE) Product Safety Requirements",
                        description: "Devices intended for children must comply with additional safety requirements.",
                        requirement: "Child-oriented devices must comply with all applicable children's product safety requirements.",
                        controlPlanDetails: "Control Plan - HW Compliance:\n* HVT Phase - Compliance certification testing per requirements listed in \"Description\" section.\n* Deliverable – Test data results and evaluation report.\n* EVT Phase – Delta vs HVT phase: Compliance certification testing to requirements listed in \"Description\" section.\n* Deliverable – Once a product passes the children's product tests, the EC and Legal teams at Lab will work on the issuance of a Children's Product Certificate (\"CPC\").",
                        riskLevel: "High Risk"
                    },
                    {
                        section: "Environmental Compliance",
                        topic: "Device Material Causes Harmful Effects to Human or Environment",
                        description: "Materials used in the device may cause harmful effects to humans or the environment.",
                        requirement: "All the materials for Greenwood device need to meet the environmental compliance requirements to protect customer health and minimize effects on the environmental.",
                        controlPlanDetails: "Control Plan:\n* EC team will ask CM to collect the EC declaration and 3rd party test report based on the BOM information and arrange the EC testing for DVT sample to minimize the risk. All the document collection and testing need to be completed before PVTRR. EC team will provide the risk level for the DVTRR and PVTRR.",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Process",
                        topic: "Solder Ball Issue",
                        description: "Solder balls may cause electrical shorts or other failures.",
                        requirement: "Valid solder ball detection method is required on the production line. No solder ball larger than 0.13 mm is allowed.",
                        controlPlanDetails: "Control Plan:\n* Add visual inspection in SMT FAI check: comply with IPC-A-610H standard. The solder balls are entrapped, encapsulated or attached, the diameter of solder balls is less than 0.13mm, solder balls do not violate minimum electrical clearance (0.2mm).",
                        riskLevel: "Medium Risk"
                    },
                    {
                        section: "Packaging",
                        topic: "Device Poly Bag is a Suffocation Hazard",
                        description: "Poly bags used in packaging may pose a suffocation hazard, particularly to children.",
                        requirement: "The regulation of baby and baby/child products and equipment usually focuses on design and labeling practices. For packaging of children's toys and products, bags that have an opening of 35.6 cm (14 in) or larger must carry a specific suffocation hazard warning and cannot be made of flexible film (eg, a dry cleaning-type bag).",
                        controlPlanDetails: "Control Plan:\n* If Greenwood were to use a poly bag that has an opening larger than or equal to 35.6 cm, a suffocation hazard warning will be printed onto the surface of the film. The poly bag will be made of OPP if packaging were to choose this route.",
                        riskLevel: "Low Risk"
                    }
                ]
            };

            // Define component risks for other devices (simplified for now)
            const otherDeviceComponentRisks = {
                display: [
                    {
                        section: "Product Design",
                        topic: "Display-related safety risk"
                    }
                ],
                sharpEdges: [
                    {
                        section: "Product Design",
                        topic: "Sharp edge safety risk"
                    }
                ],
                chargingPort: [
                    {
                        section: "Electrical",
                        topic: "USB port safety risk"
                    }
                ],
                speaker: [
                    {
                        section: "Electrical",
                        topic: "Speaker safety risk"
                    }
                ],
                battery: [
                    {
                        section: "Battery",
                        topic: "Battery safety risk"
                    }
                ],
                waterResistance: [
                    {
                        section: "Product Design",
                        topic: "Waterproofing safety risk"
                    }
                ],
                repairableComponents: [
                    {
                        section: "Repairability",
                        topic: "Repair safety risk"
                    }
                ]
            };

            // Return appropriate risks based on device type
            if (device === 'tablet') {
                return tabletComponentRisks[component] || [];
            } else if (device === 'hearable') {
                return hearableComponentRisks[component] || [];
            } else if (device === 'wearable') {
                return wearableComponentRisks[component] || [];
            } else if (device === 'ereader') {
                return ereaderComponentRisks[component] || [];
            } else if (device === 'efd') {
                return efdComponentRisks[component] || [];
            } else {
                return otherDeviceComponentRisks[component] || [];
            }
        }

        // Function to get device display name
        function getDeviceDisplayName(device, deviceType) {
            const displayNames = {
                tablet: deviceType === 'ket' ? 'Tablet KET' : 'Tablet',
                ereader: 'E-Reader',
                hearable: 'Hearable',
                wearable: 'Wearable',
                efd: 'EFD'
            };

            return displayNames[device] || device;
        }

       // Create HTML content for download
        function createHTMLContent() {
            const content = document.getElementById('documentContent').innerHTML;
            const deviceName = getDeviceDisplayName(selectedDevice, selectedDeviceType);

            // Create HTML with clean styling that works well when pasted into Quip
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${deviceName} DFS Document</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; }
                        table { border-collapse: collapse; width: 100%; margin: 15px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .task-row { background-color: #e6f7ff; font-weight: bold; }
                        h2, h3, h4 { color: #0078d4; margin-top: 20px; margin-bottom: 10px; }
                        .risk-details { margin-bottom: 15px; padding-left: 15px; }
                        .risk-details p { margin: 5px 0; }
                    </style>
                </head>
                <body>
                    ${content}
                </body>
                </html>
            `;
        }

        // Download HTML button
        document.getElementById('downloadBtn').addEventListener('click', function() {
            const htmlContent = createHTMLContent();
            const deviceName = getDeviceDisplayName(selectedDevice, selectedDeviceType);

            const blob = new Blob([htmlContent], {type: 'text/html'});
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `${deviceName}_DFS_document.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });

        // Copy to clipboard button
        document.getElementById('copyBtn').addEventListener('click', function() {
            // Get the entire document content
            const documentContent = document.getElementById('documentContent');

            if (!documentContent) {
                alert('No document content found to copy.');
                return;
            }

            // Use the modern clipboard API if available
            if (navigator.clipboard && navigator.clipboard.write) {
                const htmlBlob = new Blob([documentContent.innerHTML], { type: 'text/html' });

                navigator.clipboard.write([
                    new ClipboardItem({
                        'text/html': htmlBlob
                    })
                ]).then(() => {
                    // Show success message
                    const successMsg = document.getElementById('copySuccess');
                    successMsg.style.display = 'inline';
                    setTimeout(() => {
                        successMsg.style.display = 'none';
                    }, 3000);
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                    fallbackCopyToClipboard(documentContent.innerHTML);
                });
            } else {
                // Fallback for browsers that don't support the Clipboard API
                fallbackCopyToClipboard(documentContent.innerHTML);
            }
        });

        // Fallback copy to clipboard function
        function fallbackCopyToClipboard(html) {
            const tempTextArea = document.getElementById('tempTextArea');
            tempTextArea.value = html;
            tempTextArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    const successMsg = document.getElementById('copySuccess');
                    successMsg.style.display = 'inline';
                    setTimeout(() => {
                        successMsg.style.display = 'none';
                    }, 3000);
                } else {
                    console.error('Failed to copy using execCommand');
                }
            } catch (err) {
                console.error('Failed to copy: ', err);
            }
        }
    </script>
</body>
</html>